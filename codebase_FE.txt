

================================================
FILE PATH: app-config.json
================================================
{
  "app": {
    "title": "zaui-LoctionVoucher",
    "textColor": {
      "light": "black",
      "dark": "white"
    },
    "statusBar": "transparent",
    "actionBarHidden": true,
    "hideIOSSafeAreaBottom": false,
    "hideAndroidBottomNavigationBar": false
  },
  "listCSS": [],
  "listSyncJS": [],
  "listAsyncJS": []
}


================================================
FILE PATH: package.json
================================================
{
  "name": "zaui-loctionvoucher",
  "private": true,
  "version": "1.0.0",
  "description": "zmp-blank-templates",
  "repository": "",
  "license": "UNLICENSED",
  "browserslist": [
    "Android >= 5",
    "IOS >= 9.3",
    "Edge >= 15",
    "Safari >= 9.1",
    "Chrome >= 49",
    "Firefox >= 31",
    "Samsung >= 5"
  ],
  "scripts": {
    "login": "zmp login",
    "start": "zmp start",
    "deploy": "zmp deploy"
  },
  "dependencies": {
    "@react-google-maps/api": "^2.20.7",
    "axios": "^1.13.2",
    "leaflet": "^1.9.4",
    "leaflet.markercluster": "^1.5.3",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "react-leaflet": "^4.2.1",
    "react-leaflet-cluster": "^4.0.0",
    "recoil": "^0.7.7",
    "zmp-sdk": "latest",
    "zmp-ui": "latest"
  },
  "devDependencies": {
    "@types/leaflet": "^1.9.21",
    "@types/leaflet.markercluster": "^1.5.6",
    "@types/react": "^18.3.1",
    "@types/react-dom": "^18.3.0",
    "@types/react-leaflet": "^2.8.3",
    "@vitejs/plugin-react": "^4.3.1",
    "autoprefixer": "^10.4.19",
    "cross-env": "^7.0.3",
    "postcss": "^8.4.38",
    "postcss-cli": "^8.3.1",
    "postcss-preset-env": "^6.7.0",
    "sass": "^1.76.0",
    "tailwindcss": "^3.4.3",
    "vite": "^5.2.13",
    "zmp-vite-plugin": "latest"
  }
}


================================================
FILE PATH: postcss.config.js
================================================
const tailwindcss = require("tailwindcss");

module.exports = {
  plugins: [tailwindcss("./tailwind.config.js"), require("autoprefixer")],
};


================================================
FILE PATH: src\app.ts
================================================
// ZaUI stylesheet
import 'zmp-ui/zaui.css';
// Tailwind stylesheet
import '@/css/tailwind.scss';
// Your stylesheet
import '@/css/app.scss';

// React core
import React from 'react';
import { createRoot } from 'react-dom/client';

// Expose app configuration
import appConfig from '../app-config.json';
import MyApp from './components/app';

if (!window.APP_CONFIG) {
  window.APP_CONFIG = appConfig as any;
}

const root = createRoot(document.getElementById('app')!);
root.render(React.createElement(MyApp));


================================================
FILE PATH: src\components\app.tsx
================================================
import { getSystemInfo } from 'zmp-sdk';
import { App, SnackbarProvider, ZMPRouter } from 'zmp-ui';
import { RecoilRoot } from 'recoil';
import { AppProps } from 'zmp-ui/app';
import Layout from './layout';

const MyApp = () => {
  const ZMPSnackbarProvider = SnackbarProvider as any;

  return (
    <RecoilRoot>
      <App theme={getSystemInfo().zaloTheme as AppProps['theme']}>
        <ZMPSnackbarProvider>
          <ZMPRouter>
            <Layout />
          </ZMPRouter>
        </ZMPSnackbarProvider>
      </App>
    </RecoilRoot>
  );
};

export default MyApp;


================================================
FILE PATH: src\components\comon\clock.tsx
================================================
import { useEffect, useState } from "react";
import { Text } from "zmp-ui";

function Clock() {
  const [time, setTime] = useState("");

  useEffect(() => {
    const updateClock = () => {
      const now = new Date();
      const formattedTime = now.toLocaleString("vi-VN", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      });
      setTime(formattedTime);
    };

    updateClock();
    const intervalId = setInterval(updateClock, 1000);
    return () => clearInterval(intervalId);
  }, []);

  return <Text className="font-mono">{time}</Text>;
}

export default Clock;


================================================
FILE PATH: src\components\comon\logo.tsx
================================================
import { SVGProps } from "react";

function Logo(props: SVGProps<SVGSVGElement>) {
  return (
    <svg
      width="88"
      height="40"
      viewBox="0 0 88 40"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
    >
      <g opacity="0.2">
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M10.3332 24.25C11.1156 24.25 11.7498 24.8842 11.7498 25.6666C11.7498 26.4491 11.1156 27.0833 10.3332 27.0833C9.55077 27.0833 8.9165 26.4491 8.9165 25.6666C8.9165 24.8842 9.55077 24.25 10.3332 24.25ZM15.9998 24.25C16.7823 24.25 17.4165 24.8842 17.4165 25.6666C17.4165 26.4491 16.7823 27.0833 15.9998 27.0833C15.2174 27.0833 14.5832 26.4491 14.5832 25.6666C14.5832 24.8842 15.2174 24.25 15.9998 24.25ZM21.6665 24.25C22.4489 24.25 23.0832 24.8842 23.0832 25.6666C23.0832 26.4491 22.4489 27.0833 21.6665 27.0833C20.8841 27.0833 20.2498 26.4491 20.2498 25.6666C20.2498 24.8842 20.8841 24.25 21.6665 24.25ZM10.3332 18.5833C11.1156 18.5833 11.7498 19.2175 11.7498 20C11.7498 20.7824 11.1156 21.4166 10.3332 21.4166C9.55077 21.4166 8.9165 20.7824 8.9165 20C8.9165 19.2175 9.55077 18.5833 10.3332 18.5833ZM15.9998 18.5833C16.7823 18.5833 17.4165 19.2175 17.4165 20C17.4165 20.7824 16.7823 21.4166 15.9998 21.4166C15.2174 21.4166 14.5832 20.7824 14.5832 20C14.5832 19.2175 15.2174 18.5833 15.9998 18.5833ZM21.6665 18.5833C22.4489 18.5833 23.0832 19.2175 23.0832 20C23.0832 20.7824 22.4489 21.4166 21.6665 21.4166C20.8841 21.4166 20.2498 20.7824 20.2498 20C20.2498 19.2175 20.8841 18.5833 21.6665 18.5833ZM10.3332 12.9166C11.1156 12.9166 11.7498 13.5509 11.7498 14.3333C11.7498 15.1157 11.1156 15.75 10.3332 15.75C9.55077 15.75 8.9165 15.1157 8.9165 14.3333C8.9165 13.5509 9.55077 12.9166 10.3332 12.9166ZM15.9998 12.9166C16.7823 12.9166 17.4165 13.5509 17.4165 14.3333C17.4165 15.1157 16.7823 15.75 15.9998 15.75C15.2174 15.75 14.5832 15.1157 14.5832 14.3333C14.5832 13.5509 15.2174 12.9166 15.9998 12.9166ZM21.6665 12.9166C22.4489 12.9166 23.0832 13.5509 23.0832 14.3333C23.0832 15.1157 22.4489 15.75 21.6665 15.75C20.8841 15.75 20.2498 15.1157 20.2498 14.3333C20.2498 13.5509 20.8841 12.9166 21.6665 12.9166Z"
          fill="currentcolor"
        />
      </g>
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M10.286 24.2856C11.075 24.2856 11.7146 24.9252 11.7146 25.7142C11.7146 26.5032 11.075 27.1428 10.286 27.1428C9.49701 27.1428 8.85742 26.5032 8.85742 25.7142C8.85742 24.9252 9.49701 24.2856 10.286 24.2856ZM21.7146 24.2856C22.5036 24.2856 23.1431 24.9252 23.1431 25.7142C23.1431 26.5032 22.5036 27.1428 21.7146 27.1428C20.9256 27.1428 20.286 26.5032 20.286 25.7142C20.286 24.9252 20.9256 24.2856 21.7146 24.2856ZM10.286 18.5713C11.075 18.5713 11.7146 19.2109 11.7146 19.9999C11.7146 20.7889 11.075 21.4285 10.286 21.4285C9.49701 21.4285 8.85742 20.7889 8.85742 19.9999C8.85742 19.2109 9.49701 18.5713 10.286 18.5713ZM16.0003 18.5713C16.7893 18.5713 17.4289 19.2109 17.4289 19.9999C17.4289 20.7889 16.7893 21.4285 16.0003 21.4285C15.2113 21.4285 14.5717 20.7889 14.5717 19.9999C14.5717 19.2109 15.2113 18.5713 16.0003 18.5713ZM21.7146 18.5713C22.5036 18.5713 23.1431 19.2109 23.1431 19.9999C23.1431 20.7889 22.5036 21.4285 21.7146 21.4285C20.9256 21.4285 20.286 20.7889 20.286 19.9999C20.286 19.2109 20.9256 18.5713 21.7146 18.5713ZM10.286 12.8571C11.075 12.8571 11.7146 13.4966 11.7146 14.2856C11.7146 15.0746 11.075 15.7142 10.286 15.7142C9.49701 15.7142 8.85742 15.0746 8.85742 14.2856C8.85742 13.4966 9.49701 12.8571 10.286 12.8571ZM16.0003 12.8571C16.7893 12.8571 17.4289 13.4966 17.4289 14.2856C17.4289 15.0746 16.7893 15.7142 16.0003 15.7142C15.2113 15.7142 14.5717 15.0746 14.5717 14.2856C14.5717 13.4966 15.2113 12.8571 16.0003 12.8571Z"
        fill="currentcolor"
      />
      <path
        d="M18 19.9999C18 18.8953 17.1046 17.9999 16 17.9999C14.8954 17.9999 14 18.8953 14 19.9999C14 21.1045 14.8954 21.9999 16 21.9999C17.1046 21.9999 18 21.1045 18 19.9999Z"
        fill="currentcolor"
      />
      <path
        d="M14 18.9999C14 18.4476 14.4477 17.9999 15 17.9999H17C17.5523 17.9999 18 18.4476 18 18.9999V20.9999C18 21.5522 17.5523 21.9999 17 21.9999H15C14.4477 21.9999 14 21.5522 14 20.9999V18.9999Z"
        fill="currentcolor"
      />
      <path
        d="M8.75 13.7499C8.75 13.1976 9.19772 12.7499 9.75 12.7499H10.75C11.3023 12.7499 11.75 13.1976 11.75 13.7499V14.7499C11.75 15.3022 11.3023 15.7499 10.75 15.7499H9.75C9.19772 15.7499 8.75 15.3022 8.75 14.7499V13.7499Z"
        fill="currentcolor"
      />
      <path
        d="M33.8789 14.7578H35.0659L38.0938 22.2925L41.1152 14.7578H42.3086L38.5508 24H37.624L33.8789 14.7578ZM33.4917 14.7578H34.5391L34.7104 20.3945V24H33.4917V14.7578ZM41.6421 14.7578H42.6895V24H41.4707V20.3945L41.6421 14.7578ZM45.9395 17.1318V24H44.7588V17.1318H45.9395ZM44.6699 15.3101C44.6699 15.1196 44.7271 14.9588 44.8413 14.8276C44.9598 14.6965 45.1333 14.6309 45.3618 14.6309C45.5861 14.6309 45.7575 14.6965 45.876 14.8276C45.9987 14.9588 46.0601 15.1196 46.0601 15.3101C46.0601 15.492 45.9987 15.6486 45.876 15.7798C45.7575 15.9067 45.5861 15.9702 45.3618 15.9702C45.1333 15.9702 44.9598 15.9067 44.8413 15.7798C44.7271 15.6486 44.6699 15.492 44.6699 15.3101ZM48.999 18.5981V24H47.8247V17.1318H48.9355L48.999 18.5981ZM48.7197 20.3057L48.231 20.2866C48.2352 19.8169 48.305 19.3831 48.4404 18.9854C48.5758 18.5833 48.7663 18.2342 49.0117 17.938C49.2572 17.6418 49.5492 17.4132 49.8877 17.2524C50.2305 17.0874 50.6092 17.0049 51.0239 17.0049C51.3625 17.0049 51.6672 17.0514 51.938 17.1445C52.2088 17.2334 52.4395 17.3773 52.6299 17.5762C52.8245 17.7751 52.9727 18.0332 53.0742 18.3506C53.1758 18.6637 53.2266 19.0467 53.2266 19.4995V24H52.0459V19.4868C52.0459 19.1271 51.993 18.8394 51.8872 18.6235C51.7814 18.4035 51.627 18.2448 51.4238 18.1475C51.2207 18.0459 50.971 17.9951 50.6748 17.9951C50.3828 17.9951 50.1162 18.0565 49.875 18.1792C49.638 18.3019 49.4328 18.4712 49.2593 18.687C49.09 18.9028 48.9567 19.1504 48.8594 19.4297C48.7663 19.7048 48.7197 19.9967 48.7197 20.3057ZM56.2861 17.1318V24H55.1055V17.1318H56.2861ZM55.0166 15.3101C55.0166 15.1196 55.0737 14.9588 55.188 14.8276C55.3065 14.6965 55.48 14.6309 55.7085 14.6309C55.9328 14.6309 56.1042 14.6965 56.2227 14.8276C56.3454 14.9588 56.4067 15.1196 56.4067 15.3101C56.4067 15.492 56.3454 15.6486 56.2227 15.7798C56.1042 15.9067 55.9328 15.9702 55.7085 15.9702C55.48 15.9702 55.3065 15.9067 55.188 15.7798C55.0737 15.6486 55.0166 15.492 55.0166 15.3101ZM64.9951 15.5767L61.9355 24H60.6851L64.208 14.7578H65.0142L64.9951 15.5767ZM67.5596 24L64.4937 15.5767L64.4746 14.7578H65.2808L68.8164 24H67.5596ZM67.4009 20.5786V21.5815H62.2085V20.5786H67.4009ZM71.0508 18.4521V26.6406H69.8701V17.1318H70.9492L71.0508 18.4521ZM75.6782 20.5088V20.6421C75.6782 21.1414 75.619 21.6048 75.5005 22.0322C75.382 22.4554 75.2085 22.8236 74.98 23.1367C74.7557 23.4499 74.4785 23.6932 74.1484 23.8667C73.8184 24.0402 73.4396 24.127 73.0122 24.127C72.5763 24.127 72.1912 24.055 71.8569 23.9111C71.5226 23.7673 71.2391 23.5578 71.0063 23.2827C70.7736 23.0076 70.5874 22.6776 70.4478 22.2925C70.3123 21.9074 70.2192 21.4736 70.1685 20.9912V20.2803C70.2192 19.7725 70.3145 19.3175 70.4541 18.9155C70.5938 18.5135 70.7778 18.1707 71.0063 17.8872C71.2391 17.5994 71.5205 17.3815 71.8506 17.2334C72.1807 17.0811 72.5615 17.0049 72.9932 17.0049C73.4248 17.0049 73.8078 17.0895 74.1421 17.2588C74.4764 17.4238 74.7578 17.6608 74.9863 17.9697C75.2148 18.2786 75.3862 18.6489 75.5005 19.0806C75.619 19.508 75.6782 19.984 75.6782 20.5088ZM74.4976 20.6421V20.5088C74.4976 20.166 74.4616 19.8444 74.3896 19.5439C74.3177 19.2393 74.2056 18.9727 74.0532 18.7441C73.9051 18.5114 73.7147 18.3294 73.4819 18.1982C73.2492 18.0628 72.972 17.9951 72.6504 17.9951C72.3542 17.9951 72.096 18.0459 71.876 18.1475C71.6602 18.249 71.4761 18.3866 71.3237 18.5601C71.1714 18.7293 71.0465 18.924 70.9492 19.144C70.8561 19.3599 70.7863 19.5841 70.7397 19.8169V21.4609C70.8244 21.7572 70.9429 22.0365 71.0952 22.2988C71.2476 22.557 71.4507 22.7664 71.7046 22.9272C71.9585 23.0838 72.278 23.1621 72.6631 23.1621C72.9805 23.1621 73.2534 23.0965 73.4819 22.9653C73.7147 22.8299 73.9051 22.6458 74.0532 22.4131C74.2056 22.1803 74.3177 21.9137 74.3896 21.6133C74.4616 21.3086 74.4976 20.9849 74.4976 20.6421ZM78.3506 18.4521V26.6406H77.1699V17.1318H78.249L78.3506 18.4521ZM82.978 20.5088V20.6421C82.978 21.1414 82.9188 21.6048 82.8003 22.0322C82.6818 22.4554 82.5083 22.8236 82.2798 23.1367C82.0555 23.4499 81.7783 23.6932 81.4482 23.8667C81.1182 24.0402 80.7394 24.127 80.312 24.127C79.8761 24.127 79.491 24.055 79.1567 23.9111C78.8224 23.7673 78.5389 23.5578 78.3062 23.2827C78.0734 23.0076 77.8872 22.6776 77.7476 22.2925C77.6121 21.9074 77.519 21.4736 77.4683 20.9912V20.2803C77.519 19.7725 77.6143 19.3175 77.7539 18.9155C77.8936 18.5135 78.0776 18.1707 78.3062 17.8872C78.5389 17.5994 78.8203 17.3815 79.1504 17.2334C79.4805 17.0811 79.8613 17.0049 80.293 17.0049C80.7246 17.0049 81.1076 17.0895 81.4419 17.2588C81.7762 17.4238 82.0576 17.6608 82.2861 17.9697C82.5146 18.2786 82.686 18.6489 82.8003 19.0806C82.9188 19.508 82.978 19.984 82.978 20.5088ZM81.7974 20.6421V20.5088C81.7974 20.166 81.7614 19.8444 81.6895 19.5439C81.6175 19.2393 81.5054 18.9727 81.353 18.7441C81.2049 18.5114 81.0145 18.3294 80.7817 18.1982C80.549 18.0628 80.2718 17.9951 79.9502 17.9951C79.654 17.9951 79.3958 18.0459 79.1758 18.1475C78.96 18.249 78.7759 18.3866 78.6235 18.5601C78.4712 18.7293 78.3464 18.924 78.249 19.144C78.1559 19.3599 78.0861 19.5841 78.0396 19.8169V21.4609C78.1242 21.7572 78.2427 22.0365 78.395 22.2988C78.5474 22.557 78.7505 22.7664 79.0044 22.9272C79.2583 23.0838 79.5778 23.1621 79.9629 23.1621C80.2803 23.1621 80.5532 23.0965 80.7817 22.9653C81.0145 22.8299 81.2049 22.6458 81.353 22.4131C81.5054 22.1803 81.6175 21.9137 81.6895 21.6133C81.7614 21.3086 81.7974 20.9849 81.7974 20.6421Z"
        fill="currentcolor"
      />
    </svg>
  );
}

export default Logo;


================================================
FILE PATH: src\components\layout.tsx
================================================
import { Routes, Route, useLocation } from 'react-router-dom'; // Thêm useLocation
import { Box } from 'zmp-ui';
import HomePage from '@/pages/home';
import MapPage from '@/pages/map';
import VoucherPage from '@/pages/voucher';
import ProfilePage from '@/pages/profile';
import WelcomePage from '@/pages/welcome';
import CustomBottomNavigation from './navigation';
import StoreDetailPage from '@/pages/store';
import MyVoucherPage from '@/pages/profile/my-voucher/index';

const Layout = () => {
  const location = useLocation();
  const isWelcomePage = location.pathname === '/' || location.pathname === '/welcome';

  return (
    <Box className="flex-1 flex flex-col h-screen overflow-hidden">
      <Box className="flex-1 overflow-auto relative">
        <Routes>
          <Route path="/" element={<WelcomePage />} />
          <Route path="/welcome" element={<WelcomePage />} />
          <Route path="/home" element={<HomePage />} />
          <Route path="/map" element={<MapPage />} />
          <Route path="/voucher" element={<VoucherPage />} />
          <Route path="/profile" element={<ProfilePage />} />
          <Route path="/store/:id" element={<StoreDetailPage />} />
          <Route path="/my-voucher" element={<MyVoucherPage />} />
        </Routes>
      </Box>

      {!isWelcomePage && <CustomBottomNavigation />}
    </Box>
  );
};

export default Layout;


================================================
FILE PATH: src\components\map\StoreCard.tsx
================================================
import React, { useCallback } from 'react';
import { Box, Icon, Button, Text as ZText } from 'zmp-ui';
import { Store } from '@/types/store';
import { useNavigate } from 'react-router-dom';
import { FaDirections, FaStar } from 'react-icons/fa';

// Định nghĩa props riêng cho StoreCard
interface StoreCardProps {
  store: Store;
  isSelected: boolean;
  onSelect: (store: Store) => void;
}

const StoreCard: React.FC<StoreCardProps> = ({ store, isSelected, onSelect }) => {
  const navigate = useNavigate();

  const handleViewDetail = useCallback(
    (e: React.MouseEvent) => {
      e.stopPropagation();
      navigate(`/store/${store.id}`);
    },
    [navigate, store.id]
  );

  const handleDirections = useCallback(
    (e: React.MouseEvent) => {
      e.stopPropagation();
      console.log('Chỉ đường:', store.name);
    },
    [store.name]
  );

  const handleCardClick = useCallback(() => {
    onSelect(store);
  }, [onSelect, store]);

  const hasFlashSale = store.vouchers?.some((v: any) => v.type === 'FLASH_SALE');
  const voucherCount = store.vouchers?.length || 0;

  return (
    <div
      id={`store-card-${store.id}`}
      className={`bg-white rounded-2xl p-3 mb-5 shadow-xl border border-gray-100 flex flex-col h-max w-[55vw] max-w-[300px] shrink-0 snap-center relative transition-all duration-300 ${
        isSelected ? 'ring-2 ring-[#D83231] scale-[1.02]' : ''
      }`}
      onClick={handleCardClick}
    >
      <div className="relative w-full h-36 rounded-xl overflow-hidden mb-1 group shrink-0">
        <img
          src={store.image || 'https://via.placeholder.com/400x200'}
          className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
          alt={store.name}
          loading="lazy"
          onError={(e) => (e.currentTarget.src = 'https://via.placeholder.com/400x200')}
        />

        <Box className="absolute top-2 left-2 flex flex-col gap-1 items-start z-10">
          {hasFlashSale && (
            <ZText className="bg-orange-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1">
              <Icon icon="zi-poll" size={10} /> Flash Sale
            </ZText>
          )}

          {voucherCount > 0 && (
            <ZText className="bg-[#d83231] text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1">
              <Icon icon="zi-note" size={10} /> {voucherCount} ưu đãi
            </ZText>
          )}
        </Box>
      </div>

      <div className="flex-1 flex flex-col">
        <h3 className="font-extrabold text-base text-gray-900 line-clamp-1 mb-1">{store.name}</h3>

        <div className="flex items-center gap-2 mb-2">
          <div className="flex items-center gap-0.5">
            <FaStar className="text-yellow-400 text-xs" />
            <span className="text-xs font-bold text-gray-800">4.8</span>
          </div>
          <span className="text-gray-300 text-xs">|</span>
          <span className="text-xs text-gray-500 line-clamp-1 flex-1">{store.address}</span>
        </div>

        <div className="mt-auto flex items-center gap-2">
          <Button
            className="flex-1 bg-[#d83231] hover:bg-[#d12323] active:bg-[#a81b1b] text-white font-bold rounded-lg h-9 text-xs shadow-md shadow-pink-100 border-none"
            onClick={handleViewDetail}
          >
            Xem chi tiết
          </Button>

          <div
            className="w-9 h-9 flex items-center justify-center border border-red-100 bg-red-50 rounded-lg text-[#ea4c62] active:scale-95 transition-transform cursor-pointer"
            onClick={handleDirections}
          >
            <FaDirections size={16} />
          </div>
        </div>
      </div>
    </div>
  );
};

export default React.memo(StoreCard, (prev, next) => {
  return prev.store.id === next.store.id && prev.isSelected === next.isSelected;
});


================================================
FILE PATH: src\components\navigation.tsx
================================================
import { useNavigate, useLocation } from 'react-router-dom';
import { BottomNavigation } from 'zmp-ui';
import { FaHome, FaMapMarkedAlt, FaFireAlt, FaUser } from 'react-icons/fa';

const CustomBottomNavigation = () => {
  const navigate = useNavigate();
  const location = useLocation();

  const activeColor = '#d83231';
  const defaultColor = '#94a3b8';

  const getColor = (path) => {
    return location.pathname === path ? activeColor : defaultColor;
  };

  return (
    <BottomNavigation
      fixed
      activeKey={location.pathname}
      onChange={(key) => navigate(key)}
      className="z-[2000]  [&_.zaui-bottom-navigation-item-active]:text-[#d83231]"
    >
      <BottomNavigation.Item
        key="/home"
        label="Trang chủ"
        icon={<FaHome size={24} color={getColor('/home')} />}
      />

      <BottomNavigation.Item
        key="/map"
        label="Bản đồ"
        icon={<FaMapMarkedAlt size={24} color={getColor('/map')} />}
      />

      <BottomNavigation.Item
        key="/voucher"
        label="Khuyến mãi"
        icon={<FaFireAlt size={24} color={getColor('/voucher')} />}
      />

      <BottomNavigation.Item
        key="/profile"
        label="Tài khoản"
        icon={<FaUser size={24} color={getColor('/profile')} />}
      />
    </BottomNavigation>
  );
};

export default CustomBottomNavigation;


================================================
FILE PATH: src\components\StoreDetailSheet.tsx
================================================
import { useMemo } from 'react';
import { Sheet, Button, Text, Box } from 'zmp-ui';
import { usePublicStore } from '@/hooks/usePublicStore';
import { useMyWallet } from '@/hooks/useMyWallet';
import { Voucher } from '@/types/store';

const StoreDetailSheet = () => {
  const { selectedStore, setSelectedStore } = usePublicStore();
  const { saveVoucher, myVouchers } = useMyWallet();

  const vouchers = selectedStore?.vouchers || [];

  const savedVoucherIds = useMemo(() => {
    return new Set((myVouchers || []).map((item) => item.voucher_id));
  }, [myVouchers]);

  return (
    <Sheet
      visible={!!selectedStore}
      onClose={() => setSelectedStore(null)}
      autoHeight
      mask
      handler
      swipeToClose
    >
      {selectedStore && (
        <Box p={4} className="pb-10">
          <div className="flex gap-4">
            <img
              src={selectedStore.image || 'https://via.placeholder.com/100'}
              className="w-24 h-24 rounded-lg object-cover bg-gray-100"
              alt={selectedStore.name}
              onError={(e) => (e.currentTarget.src = 'https://via.placeholder.com/100')}
            />
            <div className="flex-1">
              <Text.Title className="text-orange-600 font-bold">{selectedStore.name}</Text.Title>
              <Text size="small" className="text-gray-500 mt-1">
                {selectedStore.address}
              </Text>
            </div>
          </div>

          <div className="w-full h-[1px] bg-gray-100 my-4"></div>

          <div>
            <div className="flex justify-between items-center mb-3">
              <Text.Title size="small" className="font-bold">
                Voucher hiện có
              </Text.Title>
              <span className="text-xs text-gray-400">{vouchers.length} mã</span>
            </div>

            {vouchers.length > 0 ? (
              <div className="space-y-3">
                {vouchers.map((v: Voucher) => {
                  const isSaved = savedVoucherIds.has(v.id);

                  return (
                    <div
                      key={v.id}
                      className="border border-gray-200 rounded-xl p-3 flex justify-between items-center shadow-sm"
                    >
                      <div className="flex-1 pr-2">
                        <Text className="font-bold text-gray-800">{v.title}</Text>
                        <div className="flex items-center gap-2 mt-1">
                          <span className="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-500 font-mono">
                            {v.code}
                          </span>
                          <span className="text-xs text-orange-500 font-bold">
                            Giảm {v.discount}
                          </span>
                        </div>
                      </div>

                      <Button
                        size="small"
                        className={
                          isSaved
                            ? 'bg-gray-400 text-gray-700 min-w-[70px]'
                            : 'bg-orange-500 text-white min-w-[70px]'
                        }
                        onClick={() => !isSaved && saveVoucher(v.id)}
                        disabled={isSaved}
                      >
                        {isSaved ? 'Đã lưu' : 'Lưu'}
                      </Button>
                    </div>
                  );
                })}
              </div>
            ) : (
              <div className="text-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-300">
                <Text className="text-gray-400 italic">Quán này chưa có voucher nào :(</Text>
              </div>
            )}
          </div>
        </Box>
      )}
    </Sheet>
  );
};

export default StoreDetailSheet;


================================================
FILE PATH: src\components\TrendingCard.tsx
================================================
import React, { useMemo } from 'react';
import { Text } from 'zmp-ui';
import { Store } from '@/types/store';
import { FaStar } from 'react-icons/fa';

interface TrendingCardProps {
  store: Store;
  onClick: () => void;
}

const TrendingCard = React.memo(({ store, onClick }: TrendingCardProps) => {
  // Tính toán giảm giá tối đa
  const maxDiscount = useMemo(() => {
    if (!store.vouchers?.length) return null;

    // Lấy voucher có phần trăm giảm giá lớn nhất
    const percentVouchers = store.vouchers.filter((v) => Number(v.discount_percent) > 0);
    if (percentVouchers.length > 0) {
      const max = Math.max(...percentVouchers.map((v) => Number(v.discount_percent)));
      return `-${max}%`;
    }

    // Lấy voucher giảm tiền mặt
    const amountVouchers = store.vouchers.filter((v) => Number((v as any).discount_amount) > 0);
    if (amountVouchers.length > 0) {
      const max = Math.max(...amountVouchers.map((v) => Number((v as any).discount_amount)));
      return `${(max / 1000).toFixed(0)}K`;
    }
    return null;
  }, [store.vouchers]);

  // Format khoảng cách
  const formattedDistance = useMemo(() => {
    if (store.distance === undefined) return '';
    return store.distance < 1
      ? `${(store.distance * 1000).toFixed(0)} m`
      : `${store.distance.toFixed(1)} km`;
  }, [store.distance]);

  return (
    <div
      className="flex-shrink-0 w-[160px] flex flex-col bg-white rounded-2xl overflow-hidden active:opacity-90 transition-all snap-start border border-red-500 shadow-sm relative"
      onClick={onClick}
    >
      <div className="h-[120px] w-full relative">
        <img
          src={store.image || 'https://via.placeholder.com/150'}
          className="w-full h-full object-cover"
          alt={store.name}
          loading="lazy"
          onError={(e) => (e.currentTarget.src = 'https://via.placeholder.com/150')}
        />
      </div>

      <div className="px-3 pb-3 flex flex-col pt-2">
        <Text className=" font-semibold text-[16px] text-gray-800 line-clamp-1 leading-tight">
          {store.name}
        </Text>

        <Text className="text-sm text-gray-500 line-clamp-1 mb-2">
          {store.category || 'Địa điểm'}
        </Text>

        <div className="flex flex-col items-start gap-2 mt-auto">
          <div className="flex text-yellow-400 text-xs gap-0.5">
            {[...Array(5)].map((_, i) => (
              <FaStar key={i} />
            ))}
          </div>
          {formattedDistance && (
            <Text className="text-[#D83231] text-sm font-semibold line-clamp-1">
              {formattedDistance}
            </Text>
          )}

          {maxDiscount && (
            <div className="absolute bottom-2 right-2 bg-[#D83231] text-white text-base font-semibold px-2 py-3 rounded-xl z-10 flex items-center justify-center min-w-[40px]">
              {maxDiscount}
            </div>
          )}
        </div>
      </div>
    </div>
  );
});

export default TrendingCard;


================================================
FILE PATH: src\constants\categories.tsx
================================================
import {
  FaLayerGroup,
  FaHeartbeat,
  FaConciergeBell,
  FaUtensils,
  FaCoffee,
  FaHamburger,
  FaMugHot,
} from 'react-icons/fa';

export const CATEGORY_LABELS = {
  ALL: 'Tất cả',
  HEALTH: 'Sức khỏe',
  SERVICE: 'Dịch vụ',
  FOOD: 'Ăn uống',
  FLASH_SALE: 'Flash Sale',
  DRINK: 'Đồ uống',
  SNACK: 'Ăn vặt',
};

export const MAP_CATEGORY_CONFIG = [
  {
    key: 'ALL',
    label: CATEGORY_LABELS.ALL,
    icon: <FaLayerGroup />,
    color: 'bg-gray-600',
    activeColor: 'bg-white',
    ringColor: 'ring-gray-100',
  },
  {
    key: 'HEALTH',
    label: CATEGORY_LABELS.HEALTH,
    icon: <FaHeartbeat />,
    color: 'bg-green-600',
    activeColor: 'bg-green-600',
    ringColor: 'ring-green-100',
  },
  {
    key: 'FOOD',
    label: CATEGORY_LABELS.FOOD,
    icon: <FaUtensils />,
    color: 'bg-red-500',
    activeColor: 'bg-red-500',
    ringColor: 'ring-red-100',
  },
  {
    key: 'SERVICE',
    label: CATEGORY_LABELS.SERVICE,
    icon: <FaConciergeBell />,
    color: 'bg-blue-500',
    activeColor: 'bg-blue-500',
    ringColor: 'ring-blue-100',
  },
];

export const VOUCHER_TABS = [
  CATEGORY_LABELS.ALL,
  CATEGORY_LABELS.FLASH_SALE,
  'F&B',
  'Cafe',
  CATEGORY_LABELS.SNACK,
  'Nhà hàng',
  'Trà sữa',
];


================================================
FILE PATH: src\css\app.scss
================================================
.page {
  padding: 16px 16px 96px 16px;
}

.section-container {
  padding: 16px;
  background: #ffffff;
  border-radius: 8px;
  margin-bottom: 24px;
}

.zaui-list-item {
  cursor: pointer;
}

:root {
  --app-primary: #d83231;
}

.zaui-header {
  background-color: var(--app-primary) !important;
  border-bottom: none !important;
  height: 80px !important;

  .zaui-header-title {
    color: white !important;
  }

  .zaui-icon {
    color: white !important;
  }
}

@keyframes user-bounce {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-15px);
  }
}

.user-marker-bounce {
  animation: user-bounce 1.5s infinite ease-in-out;
  filter: drop-shadow(0 10px 5px rgba(0, 0, 0, 0.3));
}

.custom-pin-icon {
  background: none !important;
  border: none !important;
}


================================================
FILE PATH: src\css\tailwind.scss
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;


================================================
FILE PATH: src\hooks\useMyWallet.ts
================================================
import { useState, useCallback } from 'react';
import { useRecoilState } from 'recoil';
import { myVouchersState } from '@/states/state';
import { getAccessToken } from 'zmp-sdk';
import { storeService } from '@/services/store.service';

export const useMyWallet = () => {
  const [myVouchers, setMyVouchers] = useRecoilState(myVouchersState);
  const [loading, setLoading] = useState(false);

  const fetchMyWallet = useCallback(async () => {
    setLoading(true);
    try {
      const accessToken = await getAccessToken({});
      const res = await storeService.getMyWallet(accessToken);

      if (res.data) {
        setMyVouchers(res.data);
      } else {
        setMyVouchers([]);
      }
    } catch (error) {
      console.error('Lỗi lấy ví:', error);
    } finally {
      setLoading(false);
    }
  }, [setMyVouchers]);

  const saveVoucher = useCallback(
    async (voucherId: number) => {
      try {
        const accessToken = await getAccessToken({});
        const res = await storeService.saveVoucher(voucherId, accessToken);

        if (res.success) {
          fetchMyWallet();
          return { success: true, message: 'Lưu thành công!' };
        }
        return { success: false, message: res.message || 'Không thể lưu voucher' };
      } catch (error: any) {
        console.error('Lỗi lưu voucher:', error);
        const msg = error?.response?.data?.error || 'Lỗi hệ thống';
        return { success: false, message: msg };
      }
    },
    [fetchMyWallet]
  );

  const useVoucher = useCallback(
    async (voucherId: number) => {
      try {
        const accessToken = await getAccessToken({});
        const res = await storeService.useVoucher(voucherId, accessToken);
        if (res.success) {
          fetchMyWallet();
          return { success: true };
        }
        return { success: false, message: res.message };
      } catch (error: any) {
        return { success: false, message: error?.response?.data?.error || 'Lỗi hệ thống' };
      }
    },
    [fetchMyWallet]
  );

  const unsaveVoucher = useCallback(
    async (voucherId: number) => {
      try {
        const accessToken = await getAccessToken({});
        const res = await storeService.unsaveVoucher(voucherId, accessToken);
        if (res.success) {
          fetchMyWallet();
          return { success: true };
        }
        return { success: false, message: res.message };
      } catch (error: any) {
        return { success: false, message: error?.response?.data?.error || 'Lỗi hủy lưu' };
      }
    },
    [fetchMyWallet]
  );

  return {
    myVouchers,
    loading,
    fetchMyWallet,
    saveVoucher,
    unsaveVoucher,
    useVoucher,
  };
};


================================================
FILE PATH: src\hooks\usePublicStore.ts
================================================
import { useState, useCallback } from 'react';
import { useRecoilState, useRecoilValue } from 'recoil';
import { storesState, selectedStoreState, userLocationState, flashSaleState } from '@/states/state';
import { getAccessToken } from 'zmp-sdk';
import { storeService } from '@/services/store.service';

export const usePublicStore = () => {
  const [stores, setStores] = useRecoilState(storesState);
  const [selectedStore, setSelectedStore] = useRecoilState(selectedStoreState);
  const userLocation = useRecoilValue(userLocationState);
  const [flashSales, setFlashSales] = useRecoilState(flashSaleState);
  const [loading, setLoading] = useState(false);

  const fetchNearby = useCallback(
    async (params?: { lat?: number; lng?: number; category?: string; forceRefresh?: boolean }) => {
      const lat = params?.lat || userLocation[0];
      const lng = params?.lng || userLocation[1];
      const category = params?.category || 'Tất cả';

      if (stores.length > 0 && !params?.forceRefresh && category === 'Tất cả') return;

      if (!lat || !lng) return;

      setLoading(true);
      try {
        const res = await storeService.getNearby({ lat, lng, category });

        if (res.data) {
          setStores(res.data);
        } else {
          setStores([]);
        }
      } catch (error) {
        console.error('Lỗi lấy quán gần đây:', error);
        setStores([]);
      } finally {
        setLoading(false);
      }
    },
    [userLocation, setStores]
  );

  const search = useCallback(
    async (keyword: string) => {
      setLoading(true);
      try {
        const res = await storeService.search(keyword);
        if (res.data) {
          setStores(res.data);
        } else {
          setStores([]);
        }
      } catch (error) {
        console.error('Lỗi tìm kiếm:', error);
        setStores([]);
      } finally {
        setLoading(false);
      }
    },
    [setStores]
  );

  const fetchFlashSales = useCallback(
    async (category: string = 'Tất cả') => {
      try {
        const accessToken = await getAccessToken({});
        const res = await storeService.getFlashSales(accessToken, category);

        if (res.data) {
          setFlashSales(res.data);
        } else {
          setFlashSales([]);
        }
      } catch (error) {
        console.error('Lỗi lấy Flash Sale:', error);
        setFlashSales([]);
      }
    },
    [setFlashSales]
  );

  return {
    stores,
    selectedStore,
    setSelectedStore,
    flashSales,
    loading,
    fetchNearby,
    search,
    fetchFlashSales,
  };
};


================================================
FILE PATH: src\hooks\useStore.ts
================================================
import { usePublicStore } from './usePublicStore';
import { useMyWallet } from './useMyWallet';

export const useStore = () => {
  const publicData = usePublicStore();
  const walletData = useMyWallet();

  return {
    ...publicData,
    ...walletData,
    loading: publicData.loading || walletData.loading,
  };
};


================================================
FILE PATH: src\hooks\useUserInit.ts
================================================
import { useEffect, useCallback } from 'react';
import { useSetRecoilState } from 'recoil';
import { userState, userLoadingState } from '@/states/state';
import { getUserInfo, getAccessToken } from 'zmp-sdk';
import { events, EventName } from 'zmp-sdk/apis';
import api from '@/services/api';
import { User } from '@/types/user';

let lastSyncTime = 0;
const SYNC_COOLDOWN = 5 * 60 * 1000;

const syncUserToBackend = async (zaloUserInfo: {
  name: string;
  avatar: string;
  id: string;
}): Promise<User | null> => {
  try {
    const accessToken = await getAccessToken({});
    const res: any = await api.post(
      '/api/user/sync',
      {
        name: zaloUserInfo.name,
        avatar: zaloUserInfo.avatar,
      },
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      }
    );
    return res?.data ?? null;
  } catch (e) {
    console.error('Lỗi đồng bộ User:', e);
    return null;
  }
};

export const useUserInit = () => {
  const setUser = useSetRecoilState(userState);
  const setLoading = useSetRecoilState(userLoadingState);

  const initializeUser = useCallback(
    async (isInitialLoad = false) => {
      try {
        if (isInitialLoad) {
          setLoading(true);
        }

        const { userInfo } = await getUserInfo({
          autoRequestPermission: true,
          avatarType: 'normal',
        });

        if (userInfo) {
          const now = Date.now();
          let userFromBackend: User | null = null;

          if (now - lastSyncTime > SYNC_COOLDOWN || isInitialLoad) {
            userFromBackend = await syncUserToBackend({
              id: userInfo.id,
              name: userInfo.name,
              avatar: userInfo.avatar,
            });
            if (userFromBackend) {
              lastSyncTime = now;
            }
          }

          if (userFromBackend) {
            setUser(userFromBackend);
          } else {
            setUser({
              id: userInfo.id,
              name: userInfo.name,
              avatar: userInfo.avatar,
            });
          }
        }
      } catch (error) {
        console.error('Lỗi khởi tạo user:', error);
      } finally {
        if (isInitialLoad) {
          setLoading(false);
        }
      }
    },
    [setUser, setLoading]
  );

  useEffect(() => {
    initializeUser(true);

    const onAppResume = () => {
      initializeUser(false);
    };

    events.on(EventName.AppResumed, onAppResume);
    events.on(EventName.OpenApp, onAppResume);

    return () => {
      events.off(EventName.AppResumed, onAppResume);
      events.off(EventName.OpenApp, onAppResume);
    };
  }, [initializeUser]);
};


================================================
FILE PATH: src\hooks\useUserLocation.ts
================================================
import { useCallback } from 'react';
import { useRecoilState } from 'recoil';
import { getLocation, getAccessToken, login } from 'zmp-sdk';
import api from '@/services/api';
import {
  userLocationState,
  locationLoadingState,
  locationPermissionDeniedState,
} from '@/states/state';

const PERMISSION_KEY = 'location_permission_granted';

// === ĐOẠN CODE THÊM MỚI ĐỂ TEST ===
const IS_DEV_MODE = true;
const FAKE_POSITION = { lat: 21.587631, lng: 105.840984 };
// ===================================

export const useUserLocation = () => {
  const [position, setPosition] = useRecoilState(userLocationState);
  const [loading, setLoading] = useRecoilState(locationLoadingState);
  const [isDenied, setIsDenied] = useRecoilState(locationPermissionDeniedState);

  const performGetLocation = useCallback(async () => {
    setLoading(true);
    setIsDenied(false);

    // === ĐOẠN CODE THÊM MỚI ĐỂ TEST ===
    if (IS_DEV_MODE) {
      console.log('⚠️ Đang chạy chế độ DEV: Dùng tọa độ giả lập!');
      await new Promise((r) => setTimeout(r, 500));

      setPosition([FAKE_POSITION.lat, FAKE_POSITION.lng]);
      setLoading(false);
      return true; // Báo là thành công luôn
    }
    // ===================================

    try {
      await login({});

      const locationRes: any = await new Promise((resolve, reject) => {
        getLocation({
          success: (data) => resolve(data),
          fail: (err) => reject(err),
        });
      });

      const { latitude, longitude, lat, lng, token } = locationRes;
      const finalLat = latitude || lat;
      const finalLng = longitude || lng;

      if (finalLat && finalLng) {
        setPosition([parseFloat(finalLat), parseFloat(finalLng)]);
        return true;
      }

      if (!token) throw new Error('Cần quyền vị trí');

      const accessToken = await getAccessToken({});
      const data: any = await api.post('/api/zalo/location', {
        accessToken,
        locationToken: token,
      });

      if (data && data.lat && data.lng) {
        setPosition([data.lat, data.lng]);
        return true;
      } else {
        throw new Error('Lỗi Server location');
      }
    } catch (err: any) {
      console.error('User từ chối hoặc lỗi:', err);
      setIsDenied(true);
      return false;
    } finally {
      setLoading(false);
    }
  }, [setLoading, setPosition, setIsDenied]);

  const checkLocationSilent = useCallback(async () => {
    // === ĐOẠN CODE THÊM MỚI ĐỂ TEST ===
    if (IS_DEV_MODE) {
      await performGetLocation();
      return;
    }
    // ===================================

    const hasGranted = localStorage.getItem(PERMISSION_KEY);
    if (hasGranted === 'true') {
      await performGetLocation();
    }
  }, [performGetLocation]);

  const requestLocationForce = useCallback(async () => {
    const success = await performGetLocation();
    if (success) {
      localStorage.setItem(PERMISSION_KEY, 'true');
      setIsDenied(false);
    }
  }, [performGetLocation, setIsDenied]);

  return {
    position,
    loading,
    isDenied,
    checkLocationSilent,
    requestLocationForce,
  };
};


================================================
FILE PATH: src\pages\home\CategoryQuickAccess.tsx
================================================
import React from 'react';
import { Box } from 'zmp-ui';

interface CategoryQuickAccessProps {
  onSelect: (keyword: string) => void;
  activeCategory: string;
}

const CategoryQuickAccess: React.FC<CategoryQuickAccessProps> = ({ onSelect, activeCategory }) => {
  const categories = [
    { label: 'Ăn uống', value: 'food|drink' },
    { label: 'Thể thao', value: 'sport' },
    { label: 'Giải trí', value: 'health|playground' },
    { label: 'Lưu trú', value: 'service' },
  ];

  return (
    <Box className="flex justify-center items-center gap-2 px-2 pt-4 pb-2 overflow-x-auto scrollbar-hide  bg-white/20 relative z-20">
      {categories.map((cat) => {
        const isActive = activeCategory === cat.value;
        return (
          <div
            key={cat.value}
            onClick={() => onSelect(isActive ? 'Tất cả' : cat.value)}
            className={`
              flex-shrink-0 px-4 py-2 rounded-full border border-red-500 text-red-500 text-sm font-bold shadow-sm transition-all cursor-pointer whitespace-nowrap select-none
              ${
                isActive
                  ? 'bg-[#D83231] text-white border-[#D83231] shadow-red-100'
                  : 'bg-white text-gray-600 border-gray-200 hover:border-red-200 hover:text-red-500'
              }
            `}
          >
            {cat.label}
          </div>
        );
      })}
    </Box>
  );
};

export default CategoryQuickAccess;


================================================
FILE PATH: src\pages\home\FlashSaleList.tsx
================================================
import React, { useEffect, useState } from 'react';
import { Box, Text, Button, Icon, useSnackbar } from 'zmp-ui';
import { usePublicStore } from '@/hooks/usePublicStore';
import { useMyWallet } from '@/hooks/useMyWallet';
import { useNavigate } from 'react-router-dom';
import { formatCountdown, formatDateVN } from '@/utils/dateFormatter';
import { FaBolt } from 'react-icons/fa';

const FlashSaleItem = React.memo(
  ({ item, onSave }: { item: any; onSave: (id: number) => Promise<boolean> }) => {
    const [timeLeft, setTimeLeft] = useState('');
    const [isSaved, setIsSaved] = useState(Boolean(item.is_saved));
    const [isLoading, setIsLoading] = useState(false);
    const navigate = useNavigate();

    useEffect(() => {
      const calculateTime = () => {
        const end = new Date(item.end_date).getTime();
        const now = new Date().getTime();
        const diff = end - now;
        if (diff <= 0) return '00:00:00';
        return formatCountdown(diff);
      };

      setTimeLeft(calculateTime());
      const timer = setInterval(() => {
        setTimeLeft(calculateTime());
      }, 1000);
      return () => clearInterval(timer);
    }, [item.end_date]);

    useEffect(() => {
      setIsSaved(Boolean(item.is_saved));
    }, [item.is_saved]);

    const handleButtonClick = async (e) => {
      e.stopPropagation();
      if (isSaved) {
        navigate('/my-voucher');
        return;
      }
      setIsLoading(true);
      const success = await onSave(item.id);
      setIsLoading(false);
      if (success) {
        setIsSaved(true);
      }
    };

    return (
      <div
        className="relative bg-white rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08)] mb-3 overflow-hidden flex border border-l-8 border-b-4 border-red-500"
        onClick={() => navigate(`/store/${item.store_id}`)}
      >
        <div className="flex-1 p-2 pl-2 flex flex-col justify-between">
          <div className="flex items-start mb-1">
            <div className="bg-[#D83231] text-white text-xs font-semibold px-1 py-1 rounded-md flex items-center gap-1.5 shadow-sm">
              <FaBolt className="text-white text-[10px]" />
              <span>{item.discount}</span>
              <span className="opacity-60 text-[10px]">•</span>
              <span className="font-mono tracking-wide">{timeLeft}</span>
            </div>
          </div>

          <div>
            <Text className="font-extrabold text-gray-900 text-[15px] uppercase leading-tight line-clamp-1 mb-1">
              {item.store_name}
            </Text>
            <Text className="font-bold text-gray-800 text-sm leading-tight line-clamp-2">
              {item.title}
            </Text>
          </div>

          <div className="mt-2 text-xs text-gray-500 font-medium">
            Áp dụng đến {formatDateVN(item.end_date)}
          </div>
        </div>

        <div className="flex flex-col items-end justify-between p-3 pl-0 gap-2 min-w-[75px]">
          <div className="bg-[#D83231] text-white text-[10px] w-[95px] text-center font-bold px-1 py-1 rounded">
            {item.code || 'CODE'}
          </div>

          <div className="border border-[#D83231] text-[#D83231] bg-white text-[12px] font-bold text-center w-[95px] px-4 py-0.5 rounded">
            SL: {item.quantity}
          </div>

          <button
            onClick={handleButtonClick}
            disabled={isLoading}
            className={`flex flex-col items-center justify-center w-full py-1 px-1 rounded-md transition-all active:scale-95 ${
              isSaved
                ? 'bg-gray-200 text-gray-500'
                : 'bg-[#D83231] text-white shadow-md shadow-red-100'
            }`}
          >
            {isLoading ? (
              <div className="w-4 h-4 border-2 border-white border-t-transparent animate-spin rounded-full mb-1"></div>
            ) : (
              <Box className="flex flex-wrap items-center">
                <Icon icon={isSaved ? 'zi-check' : 'zi-bookmark'} size={16} />
                <span className="text-[11px] font-medium leading-none mt-0.5">
                  {isSaved ? 'ĐÃ LƯU' : 'LƯU'}
                </span>
              </Box>
            )}
            <span className="text-[12px] font-medium leading-none mt-0.5">VOUCHER</span>
          </button>
        </div>
      </div>
    );
  },
  (prev, next) =>
    prev.item.id === next.item.id &&
    prev.item.is_saved === next.item.is_saved &&
    prev.item.quantity === next.item.quantity
);

const FlashSaleList = () => {
  const { flashSales } = usePublicStore();
  const { saveVoucher } = useMyWallet();
  const navigate = useNavigate();
  const { openSnackbar } = useSnackbar();

  const handleSaveVoucher = async (id: number): Promise<boolean> => {
    const result: any = await saveVoucher(id);
    if (result.success) {
      openSnackbar({
        text: '⚡ ' + result.message,
        type: 'success',
        duration: 3000,
        position: 'top',
      });
      return true;
    } else {
      openSnackbar({
        text: '❌ ' + (result.message || 'Lỗi'),
        type: 'error',
        duration: 3000,
        position: 'top',
      });
      return false;
    }
  };

  const hasData = flashSales && flashSales.length > 0;

  return (
    <div className="bg-white mb-2 pt-4 pb-4">
      <Box px={4} className="flex justify-between items-center mb-4">
        <div className="flex items-center gap-1">
          <Text.Title size="normal" className="font-extrabold text-gray-800 uppercase">
            FLASH SALE
          </Text.Title>
          <span className="text-[#D83231] font-bold text-lg">({flashSales.length})</span>
        </div>

        <Text
          size="large"
          className="text-[#D83231] font-bold cursor-pointer active:opacity-60 hover:underline"
          onClick={() => navigate('/voucher')}
        >
          Xem tất cả
        </Text>
      </Box>

      {hasData ? (
        <div className="px-4 flex flex-col gap-1">
          {flashSales.slice(0, 5).map((item) => (
            <FlashSaleItem key={item.id} item={item} onSave={handleSaveVoucher} />
          ))}
        </div>
      ) : (
        <div className="px-4">
          <div className="flex flex-col items-center justify-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-200">
            <div className="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-3">
              <Icon icon="zi-clock-2" className="text-gray-400" size={24} />
            </div>
            <Text className="text-gray-500 font-bold text-sm mb-1">
              Chưa có Flash Sale nào diễn ra
            </Text>
            <Text size="xxSmall" className="text-gray-400">
              Vui lòng quay lại vào khung giờ vàng nhé!
            </Text>
          </div>
        </div>
      )}
    </div>
  );
};

export default FlashSaleList;


================================================
FILE PATH: src\pages\home\index.tsx
================================================
// FILE: src/pages/home/index.tsx
import React, { useEffect, useState } from 'react';
import { Page, Input, Box, Text, Icon } from 'zmp-ui';
import { usePublicStore } from '@/hooks/usePublicStore';
import { useNavigate } from 'react-router-dom';
import WelcomeHeader from './WelcomeHeader';
import TrendingList from './TrendingList';
import FlashSaleList from './FlashSaleList';
import { Store } from '@/types/store';
import { useUserLocation } from '@/hooks/useUserLocation';
import NewsSection from './NewsSection';
import CategoryQuickAccess from './CategoryQuickAccess';

const HomePage: React.FC = () => {
  const { search, stores, loading, fetchNearby, fetchFlashSales } = usePublicStore();
  const navigate = useNavigate();

  const { position, checkLocationSilent } = useUserLocation();
  const [keyword, setKeyword] = useState('');
  const [isSearchFocused, setIsSearchFocused] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState<string>('Tất cả');

  const safeStores = Array.isArray(stores) ? stores : [];

  const handleSearch = (text: string) => {
    setKeyword(text);
  };

  const exitSearchMode = () => {
    setIsSearchFocused(false);
    setKeyword('');
    if (position && position[0]) {
      fetchNearby({
        lat: position[0],
        lng: position[1],
        category: selectedCategory,
        forceRefresh: true,
      });
    }
  };

  const handleStoreClick = (store: Store) => {
    navigate(`/store/${store.id}`);
  };

  const handleSelectCategory = (catValue: string) => {
    setSelectedCategory(catValue);
    if (position && position[0] && position[1]) {
      // Lọc danh sách Quán
      fetchNearby({
        lat: position[0],
        lng: position[1],
        category: catValue,
        forceRefresh: true,
      });

      // Lọc danh sách Flash Sale
      fetchFlashSales(catValue);
    }
  };

  useEffect(() => {
    checkLocationSilent();
  }, []);

  useEffect(() => {
    if (position && position[0] && position[1]) {
      fetchNearby({
        lat: position[0],
        lng: position[1],
        category: selectedCategory,
        forceRefresh: true,
      });
      fetchFlashSales(selectedCategory);
    }
  }, [position[0], position[1]]);

  useEffect(() => {
    const timer = setTimeout(() => {
      if (keyword.trim()) {
        search(keyword);
      } else if (keyword === '') {
        if (!isSearchFocused && position[0]) {
          fetchNearby({
            lat: position[0],
            lng: position[1],
            category: selectedCategory,
            forceRefresh: true,
          });
        }
      }
    }, 1000);

    return () => clearTimeout(timer);
  }, [keyword, isSearchFocused]);

  return (
    <Page className="bg-gray-100 h-full pb-20 relative">
      <WelcomeHeader />

      <CategoryQuickAccess onSelect={handleSelectCategory} activeCategory={selectedCategory} />

      <Box className="pt-2 pb-2 mx-2 relative z-10">
        <div
          onClick={() => setIsSearchFocused(true)}
          className="bg-white rounded-full h-12 flex items-center px-4 shadow-sm border border-gray-300 active:scale-95 transition-transform"
        >
          <Icon icon="zi-search" className="text-red-600 mr-2" />
          <Text className="text-gray-400 text-sm flex-1">Tìm kiếm theo yêu cầu...</Text>
        </div>
      </Box>

      <div className="bg-white pb-2 pt-4 rounded-2xl m-2 shadow-sm border border-gray-100">
        <TrendingList stores={safeStores.slice(0, 5)} loading={loading} />
      </div>

      <div className="bg-white pb-2 pt-4 rounded-2xl m-2 shadow-sm border border-gray-100">
        <FlashSaleList />
      </div>

      <NewsSection />

      {isSearchFocused && (
        <div className="fixed inset-0 bg-gray-50 z-[9999] flex flex-col animate-[fadeIn_0.2s_ease-in-out]">
          <div className="px-4 pt-8 pb-4 flex items-center border-b bg-[#D83231] border-gray-50">
            <div
              onClick={exitSearchMode}
              className="w-8 h-8 flex items-center justify-center -ml-2 mr-2 rounded-full active:bg-gray-100 transition-colors cursor-pointer"
            >
              <Icon icon="zi-chevron-left-header" className="text-white text-xl" />
            </div>
            <Text.Title size="normal" className="font-bold text-white pl-3">
              Tìm kiếm
            </Text.Title>
          </div>

          <div className="bg-white p-4 flex items-center gap-3 shadow-sm pt-safe-top">
            <div className="flex-1">
              <Input.Search
                placeholder="Nhập tên quán, món ăn..."
                className="bg-gray-100 rounded-full h-10 border-none"
                value={keyword}
                onChange={(e) => handleSearch(e.target.value)}
                clearable
                autoFocus
              />
            </div>
          </div>

          <div className="flex-1 overflow-y-auto p-4">
            {!loading && safeStores.length > 0 && (
              <div className="grid grid-cols-2 gap-3">
                {safeStores.map((store: Store) => (
                  <div
                    key={store.id}
                    className="bg-white p-3 rounded-xl shadow-sm active:opacity-70 flex flex-col h-full border border-gray-100"
                    onClick={() => handleStoreClick(store)}
                  >
                    <img
                      src={store.image || 'https://via.placeholder.com/150'}
                      className="h-24 w-full object-cover rounded-lg mb-2 bg-gray-100"
                      alt={store.name}
                      onError={(e) => (e.currentTarget.src = 'https://via.placeholder.com/150')}
                    />
                    <Text className="font-bold line-clamp-1 text-gray-800">{store.name}</Text>
                    <Text size="xxSmall" className="text-gray-500 line-clamp-1 mb-2">
                      {store.address}
                    </Text>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      )}
    </Page>
  );
};

export default HomePage;


================================================
FILE PATH: src\pages\home\NewsSection.tsx
================================================
import React from 'react';
import { Text, Button } from 'zmp-ui';
import { FaEye } from 'react-icons/fa';
import { useNavigate } from 'react-router-dom';

const NewsSection = () => {
  const navigate = useNavigate();

  const newsList = [
    {
      id: 1,
      title: 'Top 10 quán ngon rẻ Thái Nguyên không thể bỏ qua',
      image: 'https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=500&q=80',
      category: 'Ẩm thực',
      views: '132K',
    },
  ];

  return (
    <div className="bg-white p-4 pt-4 pb-4 rounded-2xl m-2 shadow-sm border border-gray-100">
      <div className="flex justify-between items-center mb-4">
        <Text.Title size="normal" className="font-extrabold text-gray-800 uppercase tracking-tight">
          TIN TỨC NỔI BẬT
        </Text.Title>
        <Text
          size="small"
          className="text-[#D83231] font-medium cursor-pointer active:opacity-60 hover:underline"
          onClick={() => navigate('/news')}
        >
          Xem tất cả
        </Text>
      </div>

      <div className="flex flex-col gap-4">
        {newsList.length > 0 ? (
          newsList.map((item) => (
            <div
              key={item.id}
              className="border border-red-500 rounded-2xl p-2.5 shadow-sm bg-white"
              onClick={() => console.log('Xem tin', item.id)}
            >
              <div className="h-44 w-full rounded-xl overflow-hidden mb-3 relative bg-gray-100">
                <img
                  src={item.image}
                  alt={item.title}
                  className="w-full h-full object-cover"
                  onError={(e) => (e.currentTarget.src = 'https://via.placeholder.com/400x200')}
                />
              </div>

              <Text.Title
                size="normal"
                className="font-extrabold text-gray-900 leading-tight mb-3 line-clamp-2 px-1"
              >
                {item.title}
              </Text.Title>

              <div className="flex justify-between items-center px-1">
                <div className="flex items-center gap-4">
                  <Text className="text-[#D83231] font-bold text-sm">{item.category}</Text>

                  <div className="flex items-center gap-1 text-gray-500 text-sm font-medium">
                    <FaEye size={14} />
                    <span>{item.views}</span>
                  </div>
                </div>

                <Button
                  size="small"
                  className="bg-[#D83231] text-white font-bold h-8 rounded-full px-5 shadow-lg shadow-red-100 border-none"
                >
                  Xem ngay
                </Button>
              </div>
            </div>
          ))
        ) : (
          <div className="text-gray-400 text-sm py-4 text-center">Chưa có tin tức mới</div>
        )}
      </div>
    </div>
  );
};

export default NewsSection;


================================================
FILE PATH: src\pages\home\TrendingList.tsx
================================================
import React, { useMemo } from 'react';
import { Text, Box, Icon } from 'zmp-ui';
import { useNavigate } from 'react-router-dom';
import { useRecoilValue } from 'recoil';
import { userState } from '@/states/state';
import { FaChevronRight, FaFire } from 'react-icons/fa';
import TrendingCard from '@/components/TrendingCard';

const TrendingList = ({ stores, loading }: { stores: any[]; loading: boolean }) => {
  const navigate = useNavigate();
  const user = useRecoilValue(userState);

  const skeletons = [1, 2, 3];

  const sortedStores = useMemo(() => {
    if (!stores) return [];
    return [...stores].sort((a, b) => {
      const countA = a.vouchers?.length || 0;
      const countB = b.vouchers?.length || 0;
      if (countB !== countA) return countB - countA;
      return (a.distance || 9999) - (b.distance || 9999);
    });
  }, [stores]);

  return (
    <div className="bg-white mb-2 pb-2 rounded-b-[14px]">
      <Box
        px={4}
        mb={3}
        className="flex justify-between items-center mt-1 border-b-2 border-gray-100 pb-3"
      >
        <div className="flex gap-3 items-center" onClick={() => navigate('/profile')}>
          <div className="w-10 h-10 rounded-full bg-gray-100 overflow-hidden border border-gray-200">
            <img
              src={user?.avatar || 'https://i.imgur.com/8Km9tLL.png'}
              className="w-full h-full object-cover"
              alt="avatar"
            />
          </div>
          <div className="flex flex-col justify-center">
            <div className="flex items-center gap-1">
              <Text className="font-bold text-gray-800 text-base">
                Chào <span className="text-red-500">{user?.name || 'bạn'}</span>
              </Text>
            </div>
            <Text size="xxSmall" className="text-gray-800 font-semibold">
              Bạn muốn ăn gì ? chơi gì ? ở đâu ?
            </Text>
          </div>
        </div>
      </Box>

      <Box px={4} className="flex justify-between items-center mb-3">
        <div>
          <div className="flex items-center gap-1.5">
            <Text.Title size="small" className="font-extrabold text-gray-800 uppercase italic">
              VOUCHER HOT GẦN BẠN
            </Text.Title>
            <FaFire className="text-orange-500 text-lg animate-pulse" />
          </div>
        </div>

        <div
          className="flex items-center gap-1 text-red-600 text-base font-semibold active:opacity-60"
          onClick={() => navigate('/map')}
        >
          Xem tất cả
        </div>
      </Box>

      <div className="flex overflow-x-auto px-4 gap-2 pb-2 pt-2 scrollbar-hide snap-mandatory">
        {loading ? (
          skeletons.map((i) => (
            <div
              key={i}
              className="flex-shrink-0 w-[160px] h-[250px] bg-gray-100 rounded-2xl animate-pulse"
            />
          ))
        ) : sortedStores && sortedStores.length > 0 ? (
          sortedStores.map((store) => (
            <TrendingCard
              key={store.id}
              store={store}
              onClick={() => navigate(`/store/${store.id}`)}
            />
          ))
        ) : (
          <div className="w-full py-6 flex flex-col items-center justify-center text-gray-400 bg-gray-50 rounded-lg border border-dashed border-gray-200">
            <Icon icon="zi-location" className="mb-1 text-xl opacity-40" />
            <Text size="small">Chưa có quán nào gần đây</Text>
          </div>
        )}
      </div>
    </div>
  );
};

export default TrendingList;


================================================
FILE PATH: src\pages\home\WelcomeHeader.tsx
================================================
import React from 'react';
import { Box, Text } from 'zmp-ui';

const WelcomeHeader: React.FC = () => {
  return (
    <div className="bg-[#D83231] p-4 pb-[10px] pt-12 shadow-md text-white">
      <div className="flex justify-between items-start">
        <div className="flex flex-col gap-2">
          <Text.Title size="xLarge" className="font-bold text-white mt-1">
            Thái Nguyên Voucher Maps
          </Text.Title>
          <Text size="small" className="opacity-90 text-white pl-2">
            Voucher ở mọi nơi, săn ngay nào !!!
          </Text>
        </div>
      </div>
    </div>
  );
};

export default WelcomeHeader;


================================================
FILE PATH: src\pages\map\index.tsx
================================================
import React, { useEffect, useState, useMemo } from 'react';
import { MapContainer, TileLayer, Marker, useMapEvents } from 'react-leaflet';
import MarkerClusterGroup from 'react-leaflet-cluster';
import 'leaflet/dist/leaflet.css';
import 'leaflet.markercluster/dist/MarkerCluster.css';
import 'leaflet.markercluster/dist/MarkerCluster.Default.css';
import { Icon, Box, Button, Text } from 'zmp-ui';
import { useUserLocation } from '@/hooks/useUserLocation';
import { usePublicStore } from '@/hooks/usePublicStore';
import { Store } from '@/types/store';
import { getStorePin } from './utils/mapHelpers';
import { MapController, ResizeMapListener } from './MapControls';
import MapSearchBar from './MapSearchBar';
import StoreBottomSheet from './StoreBottomSheet';
import MapFilterButton from './MapFilterButton';
import { getUserPin } from './utils/mapHelpers';
import { CATEGORY_LABELS } from '@/constants/categories';

const MapClickHandler = ({ onClick }: { onClick: () => void }) => {
  useMapEvents({
    click: () => {
      onClick();
    },
  });
  return null;
};

const MapViewComponent: React.FC = () => {
  const { position, requestLocationForce, loading: locLoading, isDenied } = useUserLocation();
  const { stores, fetchNearby, selectedStore, setSelectedStore } = usePublicStore();

  const [keyword, setKeyword] = useState('');
  const [targetZoom, setTargetZoom] = useState(16);
  const [isSheetCollapsed, setIsSheetCollapsed] = useState(false);

  const [locateTrigger, setLocateTrigger] = useState(0);

  const [selectedCategory, setSelectedCategory] = useState<string>(CATEGORY_LABELS.ALL);
  const [showFilterMenu, setShowFilterMenu] = useState(false);

  useEffect(() => {
    if (!position[0] || !position[1]) return;
    const timer = setTimeout(() => {
      if (fetchNearby) {
        fetchNearby({ category: selectedCategory });
      }
    }, 1000);
    return () => clearTimeout(timer);
  }, [position, fetchNearby, selectedCategory]);

  useEffect(() => {
    requestLocationForce();
  }, []);

  const filteredStores = useMemo(() => {
    if (!stores) return [];
    let result = stores;
    if (keyword.trim()) {
      const lowerKeyword = keyword.toLowerCase();
      result = result.filter(
        (s) =>
          s.name.toLowerCase().includes(lowerKeyword) ||
          (s.category && s.category.toLowerCase().includes(lowerKeyword)) ||
          (s.vouchers && s.vouchers.some((v: any) => v.title.toLowerCase().includes(lowerKeyword)))
      );
    }
    return result;
  }, [stores, keyword]);

  const handleLocateMe = () => {
    requestLocationForce();
    setLocateTrigger((prev) => prev + 1);
    setSelectedStore(null);
  };

  return (
    <Box className="w-full h-full relative bg-gray-100 flex flex-col">
      <MapSearchBar keyword={keyword} setKeyword={setKeyword} />

      <Box className="absolute inset-0 z-0">
        {isDenied && (
          <div className="absolute inset-0 z-[3000] bg-white/95 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center animate-fade-in">
            <div className="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mb-4 border border-red-100 shadow-sm animate-bounce">
              <Icon icon="zi-poll-solid" className="text-red-500 text-4xl" />
            </div>

            <Text.Title size="normal" className="font-bold text-gray-800 mb-2">
              Cho phép định vị?
            </Text.Title>

            <Text size="small" className="text-gray-500 mb-6 max-w-[280px]">
              Để tìm quán gần bạn, vui lòng bấm nút bên dưới và chọn <strong>"Cho phép"</strong> khi
              được hỏi.
            </Text>

            <Button
              onClick={() => requestLocationForce()}
              className="bg-[#D83231] font-bold rounded-full shadow-lg shadow-red-200"
            >
              Cấp quyền truy cập
            </Button>

            <div
              className="mt-6 text-xs text-gray-400 font-medium cursor-pointer underline"
              onClick={() => requestLocationForce()}
            >
              Thử lại
            </div>
          </div>
        )}
        <MapContainer
          center={position}
          zoom={18}
          style={{ height: '100%', width: '100%' }}
          zoomControl={false}
        >
          <MapClickHandler onClick={() => setShowFilterMenu(false)} />

          <TileLayer url="http://mt0.google.com/vt/lyrs=m&hl=vi&x={x}&y={y}&z={z}" />
          <ResizeMapListener isSheetCollapsed={isSheetCollapsed} />

          <MapController
            center={position}
            selectedStore={selectedStore}
            filteredStores={filteredStores}
            targetZoom={targetZoom}
            keyword={keyword}
            locateTrigger={locateTrigger}
          />

          <Marker position={position} zIndexOffset={10000} icon={getUserPin()} />

          <MarkerClusterGroup chunkedLoading showCoverageOnHover={false} maxClusterRadius={10}>
            {filteredStores.map((store: Store) => {
              if (!store.lat || !store.lng) return null;

              const isSelected = selectedStore?.id === store.id;

              return (
                <Marker
                  key={store.id}
                  position={[store.lat, store.lng]}
                  icon={getStorePin(store, isSelected)}
                  zIndexOffset={isSelected ? 1000 : 0}
                  eventHandlers={{
                    click: () => {
                      setTargetZoom(18);
                      setSelectedStore(store);
                      setIsSheetCollapsed(false);
                      setShowFilterMenu(false);
                    },
                  }}
                />
              );
            })}
          </MarkerClusterGroup>
        </MapContainer>

        <Box className="absolute right-4 bottom-1/2 z-[999] flex flex-col items-end gap-3 pointer-events-none translate-y-12">
          <button
            onClick={handleLocateMe}
            className="w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center text-red-500 active:scale-90 transition-transform pointer-events-auto"
          >
            {locLoading ? (
              <div className="w-6 h-6 border-2 border-red-500 border-t-transparent animate-spin rounded-full"></div>
            ) : (
              <Icon icon="zi-location-solid" />
            )}
          </button>

          <MapFilterButton
            selectedCategory={selectedCategory}
            onSelectCategory={setSelectedCategory}
            isOpen={showFilterMenu}
            setIsOpen={setShowFilterMenu}
          />
        </Box>
      </Box>

      <StoreBottomSheet
        isSheetCollapsed={isSheetCollapsed}
        setIsSheetCollapsed={setIsSheetCollapsed}
        selectedStore={selectedStore}
        setSelectedStore={setSelectedStore}
        keyword={keyword}
        filteredStores={filteredStores}
        setTargetZoom={setTargetZoom}
      />
    </Box>
  );
};

export default MapViewComponent;


================================================
FILE PATH: src\pages\map\MapControls.tsx
================================================
import { useEffect } from 'react';
import { useMap } from 'react-leaflet';
import L from 'leaflet';
import { Store } from '@/types/store';

export const MapController = ({
  center,
  selectedStore,
  filteredStores,
  targetZoom,
  keyword,
  locateTrigger,
}: {
  center: [number, number];
  selectedStore: Store | null;
  filteredStores: Store[];
  targetZoom: number;
  keyword: string;
  locateTrigger: number;
}) => {
  const map = useMap();

  // tự động zoom các quán khi tìm kiếm
  useEffect(() => {
    if (keyword && filteredStores.length > 0 && !selectedStore) {
      const validPoints = filteredStores
        .filter((s) => s.lat && s.lng)
        .map((s) => [Number(s.lat), Number(s.lng)] as [number, number]);

      if (validPoints.length > 0) {
        const bounds = L.latLngBounds(validPoints);
        map.flyToBounds(bounds, { padding: [50, 50], maxZoom: 16, duration: 1.5 });
      }
    }
  }, [keyword, filteredStores, map, selectedStore]);

  // di chuyển Map khi chọn quán
  useEffect(() => {
    if (selectedStore && selectedStore.lat && selectedStore.lng) {
      const lat = Number(selectedStore.lat);
      const lng = Number(selectedStore.lng);
      if (!isNaN(lat) && !isNaN(lng)) {
        map.flyTo([lat, lng], targetZoom, {
          animate: true,
          duration: 1.5,
          easeLinearity: 0.25,
        });
      }
    }
  }, [selectedStore, targetZoom, map]);

  useEffect(() => {
    if (locateTrigger > 0 && center[0] && center[1]) {
      map.flyTo(center, 18, { animate: true, duration: 1.5 });
    }
  }, [locateTrigger, center, map]);

  return null;
};

export const ResizeMapListener = ({ isSheetCollapsed }: { isSheetCollapsed: boolean }) => {
  const map = useMap();
  useEffect(() => {
    const timer = setTimeout(() => {
      map.invalidateSize();
    }, 310);
    return () => clearTimeout(timer);
  }, [isSheetCollapsed, map]);
  return null;
};


================================================
FILE PATH: src\pages\map\MapFilterButton.tsx
================================================
import React, { useMemo } from 'react';
import { FaFilter, FaTimes } from 'react-icons/fa';
import { MAP_CATEGORY_CONFIG, CATEGORY_LABELS } from '@/constants/categories'; // Import mới

interface MapFilterButtonProps {
  selectedCategory: string;
  onSelectCategory: (category: string) => void;
  isOpen: boolean;
  setIsOpen: (isOpen: boolean) => void;
}

const MapFilterButton: React.FC<MapFilterButtonProps> = ({
  selectedCategory,
  onSelectCategory,
  isOpen,
  setIsOpen,
}) => {
  const activeOption = useMemo(
    () => MAP_CATEGORY_CONFIG.find((opt) => opt.label === selectedCategory),
    [selectedCategory]
  );

  return (
    <div className="flex flex-col items-end gap-4 pointer-events-none relative z-[2000]">
      <div className="flex flex-col items-end gap-3 mb-1">
        {MAP_CATEGORY_CONFIG.map((opt, index) => {
          const transitionDelay = isOpen ? `${index * 50}ms` : '0ms';
          const isSelected = selectedCategory === opt.label;

          return (
            <div
              key={opt.key}
              onClick={(e) => {
                e.stopPropagation();
                onSelectCategory(opt.label);
                setIsOpen(false);
              }}
              style={{ transitionDelay }}
              className={`
                flex items-center gap-3 cursor-pointer pointer-events-auto transition-all duration-300 ease-out transform
                ${
                  isOpen
                    ? 'opacity-100 translate-y-0 scale-100'
                    : 'opacity-0 translate-y-4 scale-75 pointer-events-none absolute bottom-0 right-0'
                }
              `}
            >
              <span
                className={`
                  bg-white/90 backdrop-blur-md text-gray-700 text-xs font-bold px-3 py-1.5 rounded-lg shadow-sm border border-gray-100
                  transition-all duration-200
                  ${isSelected ? `text-blue-600 ring-2 ${opt.ringColor}` : ''}
                `}
              >
                {opt.label}
              </span>

              <div
                className={`
                  w-10 h-10 rounded-full shadow-lg flex items-center justify-center text-white transition-all duration-200 border-2 border-white
                  ${opt.color}
                  ${isSelected ? 'scale-110 ring-2 ring-white shadow-xl' : 'active:scale-95'}
                `}
              >
                <div className="text-sm drop-shadow-md">{opt.icon}</div>
              </div>
            </div>
          );
        })}
      </div>

      <button
        onClick={(e) => {
          e.stopPropagation();
          setIsOpen(!isOpen);
        }}
        className={`
          w-14 h-14 rounded-full shadow-2xl flex items-center justify-center pointer-events-auto 
          transition-all duration-500 ease-in-out relative border-4 border-white
          ${
            isOpen
              ? 'bg-gray-800 rotate-90'
              : activeOption && selectedCategory !== CATEGORY_LABELS.ALL
              ? activeOption.activeColor
              : 'bg-white hover:bg-gray-50'
          }
        `}
      >
        <div
          className={`transition-all duration-300 absolute inset-0 flex items-center justify-center ${
            isOpen ? 'scale-0 opacity-0' : 'scale-100 opacity-100'
          }`}
        >
          {selectedCategory !== CATEGORY_LABELS.ALL && activeOption ? (
            <div className="text-white text-xl drop-shadow-md">{activeOption.icon}</div>
          ) : (
            <FaFilter size={20} className="text-gray-600" />
          )}
        </div>

        <div
          className={`transition-all duration-300 absolute inset-0 flex items-center justify-center ${
            isOpen ? 'scale-100 opacity-100' : 'scale-0 opacity-0 rotate-[-90deg]'
          }`}
        >
          <FaTimes size={22} className="text-white" />
        </div>
      </button>

      {isOpen && <div className="fixed inset-0 z-[-1]" onClick={() => setIsOpen(false)}></div>}
    </div>
  );
};

export default MapFilterButton;


================================================
FILE PATH: src\pages\map\MapSearchBar.tsx
================================================
import React from 'react';
import { Box, Input, Text as ZText } from 'zmp-ui';
import { MAP_CATEGORY_CONFIG } from '@/constants/categories';

interface MapSearchBarProps {
  keyword: string;
  setKeyword: (val: string) => void;
  onTagClick?: (tag: string) => void;
}

const MapSearchBar: React.FC<MapSearchBarProps> = ({ keyword, setKeyword, onTagClick }) => {
  const suggestions = MAP_CATEGORY_CONFIG.filter((c) => c.key !== 'ALL');

  return (
    <Box className="absolute top-0 left-0 mt-3 right-0 z-[1000] p-4 flex flex-col gap-3 pointer-events-none">
      <Box className="bg-white rounded-xl shadow-md pointer-events-auto flex items-center pr-2">
        <Input.Search
          placeholder="Tìm món lẩu, nướng..."
          className="border-none h-11 flex-1"
          value={keyword}
          onChange={(e) => setKeyword(e.target.value)}
          clearable
        />
      </Box>
      <Box className="flex gap-2 pointer-events-auto overflow-x-auto scrollbar-hide">
        {suggestions.map((item) => (
          <Box
            key={item.key}
            onClick={() => (onTagClick ? onTagClick(item.label) : setKeyword(item.label))}
            className="bg-white px-3 py-1.5 rounded-full shadow-sm flex items-center gap-1.5 border border-gray-100 active:scale-95 transition-transform"
          >
            <Box className={`w-2.5 h-2.5 rounded-full ${item.color}`}></Box>
            <ZText size="xSmall" className="font-bold text-gray-700">
              {item.label}
            </ZText>
          </Box>
        ))}
      </Box>
    </Box>
  );
};

export default MapSearchBar;


================================================
FILE PATH: src\pages\map\StoreBottomSheet.tsx
================================================
import React, { useState, useEffect, useRef, useCallback } from 'react';
import { Box, Icon } from 'zmp-ui';
import { Store } from '@/types/store';
import StoreCard from '@/components/map/StoreCard';

interface StoreBottomSheetProps {
  isSheetCollapsed: boolean;
  setIsSheetCollapsed: (val: boolean) => void;
  selectedStore: Store | null;
  setSelectedStore: (store: Store | null) => void;
  keyword: string;
  filteredStores: Store[];
  setTargetZoom: (zoom: number) => void;
}

const StoreBottomSheet: React.FC<StoreBottomSheetProps> = ({
  selectedStore,
  setSelectedStore,
  filteredStores,
  setTargetZoom,
}) => {
  const [isVisible, setIsVisible] = useState(true);
  const scrollRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (selectedStore) {
      setIsVisible(true);
      setTimeout(() => {
        const cardId = `store-card-${selectedStore.id}`;
        const element = document.getElementById(cardId);
        if (element) {
          element.scrollIntoView({
            behavior: 'smooth',
            block: 'nearest',
            inline: 'center',
          });
        }
      }, 300);
    }
  }, [selectedStore]);

  const handleSelectStore = useCallback(
    (store: Store) => {
      setTargetZoom(18);
      setSelectedStore(store);
    },
    [setTargetZoom, setSelectedStore]
  );

  return (
    <>
      <div
        className={`fixed left-4 z-[999] transition-all duration-300 ${
          isVisible ? 'bottom-[370px]' : 'bottom-[60px]'
        }`}
      >
        <button
          onClick={() => setIsVisible(!isVisible)}
          className={`
            flex items-center gap-2 px-4 py-2 rounded-full shadow-lg font-bold text-sm transition-all border border-gray-100
            ${
              isVisible
                ? 'bg-white text-gray-700 hover:bg-gray-50'
                : 'bg-[#ea4c62] text-white hover:bg-[#d43f54]'
            }
          `}
        >
          <Icon icon={isVisible ? 'zi-chevron-down' : 'zi-chevron-up'} size={18} />
          <span>{isVisible ? 'Ẩn' : 'Hiện'}</span>
        </button>
      </div>

      <Box
        className={`
          fixed bottom-0 left-0 right-0 z-[1000] pb-safe
          transition-transform duration-300 ease-in-out
          ${isVisible ? 'translate-y-0' : 'translate-y-[120%]'}
        `}
      >
        <div
          ref={scrollRef}
          className="flex overflow-x-auto gap-3 px-4 pb-6 pt-2 snap-x scrollbar-hide"
        >
          {filteredStores.length === 0 ? (
            <div className="w-full bg-white rounded-xl p-4 pb-16 text-center shadow-lg mx-auto border border-gray-100">
              <span className="text-gray-500 text-sm">Không tìm thấy quán nào ở khu vực này</span>
            </div>
          ) : (
            filteredStores.map((store) => (
              <StoreCard
                key={store.id}
                store={store}
                isSelected={selectedStore?.id === store.id}
                onSelect={handleSelectStore}
              />
            ))
          )}
          <div className="w-2 shrink-0">&nbsp;</div>
        </div>
      </Box>
    </>
  );
};

export default React.memo(StoreBottomSheet);


================================================
FILE PATH: src\pages\map\utils\mapHelpers.tsx
================================================
import React from 'react';
import L from 'leaflet';
import { renderToStaticMarkup } from 'react-dom/server';
import { FaUtensils } from 'react-icons/fa';
import { GiHealthNormal } from 'react-icons/gi';
import { MdRoomService } from 'react-icons/md';
import { RiDrinks2Fill } from 'react-icons/ri';
import { Store } from '@/types/store';

export const createCustomPin = (
  color: string,
  content: React.ReactNode | string,
  isSelected: boolean = false
) => {
  const iconSize = isSelected ? 60 : 46;

  let innerHtml = '';

  if (
    typeof content === 'string' &&
    (content.startsWith('http') || content.startsWith('/') || content.startsWith('data:'))
  ) {
    innerHtml = `<img src="${content}" style="width: ${isSelected ? 30 : 22}px; height: ${
      isSelected ? 30 : 22
    }px; object-fit: contain;" />`;
  } else {
    innerHtml = renderToStaticMarkup(
      <div
        style={{
          color: color,
          fontSize: isSelected ? '28px' : '22px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
        }}
      >
        {content}
      </div>
    );
  }

  const pinSvg = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="${iconSize}" height="${iconSize}">
      <path fill="${color}" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0z"/>
      <circle cx="200" cy="192" r="150" fill="white" />
    </svg>
  `;

  return L.divIcon({
    className: 'custom-pin-icon',
    html: `
      <div style="
        position: relative; 
        width: ${iconSize}px; 
        height: ${iconSize}px; 
        filter: drop-shadow(0 3px ${isSelected ? 8 : 3}px rgba(0,0,0,${isSelected ? 0.5 : 0.3}));
        transform-origin: bottom center;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        ${isSelected ? 'transform: scale(1.1); z-index: 9999;' : ''}
      ">
        ${pinSvg}
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 75%; display: flex; align-items: center; justify-content: center;">
          ${innerHtml}
        </div>
      </div>
    `,
    iconSize: [iconSize, iconSize],
    iconAnchor: [iconSize / 2, iconSize],
    popupAnchor: [0, -iconSize + 10],
  });
};

export const getCategoryContent = (category: string | undefined) => {
  if (!category) return <FaUtensils className="text-slate-600" />;
  const cat = category.toLowerCase();

  if (cat.includes('drink')) {
    return <RiDrinks2Fill className="text-[#597718]" />;
  }
  if (cat.includes('health')) {
    return <GiHealthNormal className="text-[#EF4444]" />;
  }
  if (cat.includes('service')) {
    return <MdRoomService className="text-[#e68d27]" />;
  }
  return <FaUtensils className="text-[#AF672D]" />;
};

const getCategoryColor = (category: string | undefined) => {
  if (!category) return '#EF4444';
  const cat = category.toLowerCase();
  if (cat.includes('health')) {
    return '#00A300';
  }
  if (cat.includes('service')) {
    return '#0f80e9';
  }
  return '#B4000F';
};

export const getStorePin = (store: Store, isSelected: boolean) => {
  const pinColor = getCategoryColor(store.category);
  const iconContent = getCategoryContent(store.category);
  return createCustomPin(pinColor, iconContent, isSelected);
};

export const getUserPin = () => {
  return L.divIcon({
    className: 'custom-pin-icon',
    html: `
      <div style="
        width: 60px; 
        height: 60px; 
        display: flex; 
        justify-content: center; 
        align-items: flex-end;
      ">
        <img 
          src="https://cdn-icons-png.flaticon.com/512/9356/9356230.png" 
          class="user-marker-bounce" 
          style="width: 100%; height: 100%; object-fit: contain;"
        />
      </div>
    `,
    iconSize: [60, 60],
    iconAnchor: [30, 60],
  });
};


================================================
FILE PATH: src\pages\profile\index.tsx
================================================
import React, { useEffect, useMemo, useState, useCallback } from 'react';
import { Page, Icon, Text, Avatar } from 'zmp-ui';
import { useRecoilState } from 'recoil';
import { userState } from '@/states/state';
import { useStore } from '@/hooks/useStore';
import { getUserInfo, getAccessToken } from 'zmp-sdk';
import api from '@/services/api';
import { useNavigate } from 'react-router-dom';
import { FaCrown, FaMapMarkerAlt } from 'react-icons/fa';
import { MdOutlineKeyboardArrowRight } from 'react-icons/md';

const ProfilePage: React.FC = () => {
  const [user, setUser] = useRecoilState(userState);
  const { myVouchers, fetchMyWallet } = useStore();
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleSyncUser = useCallback(async () => {
    if (loading || user) return;
    setLoading(true);
    try {
      const { userInfo } = await getUserInfo({ autoRequestPermission: true, avatarType: 'normal' });
      if (userInfo) {
        try {
          const token = await getAccessToken({});
          await api.post(
            '/api/user/sync',
            { name: userInfo.name, avatar: userInfo.avatar },
            { headers: { Authorization: `Bearer ${token}` } }
          );
        } catch (err) {
          console.error(err);
        }
        setUser({ id: userInfo.id, name: userInfo.name, avatar: userInfo.avatar });
      }
    } catch (error) {
      console.log('User denied');
    } finally {
      setLoading(false);
    }
  }, [user, loading, setUser]);

  const handleProtectedAction = (action: () => void) => {
    if (user) {
      action();
    } else {
      handleSyncUser();
    }
  };

  useEffect(() => {
    if (!user) handleSyncUser();
    fetchMyWallet();
  }, []);

  const voucherStats = useMemo(() => {
    const list = Array.isArray(myVouchers) ? myVouchers : [];
    const now = new Date().getTime();

    const saved = list.filter(
      (v) => v.status === 'UNUSED' && new Date(v.end_date).getTime() > now
    ).length;
    const used = list.filter((v) => v.status === 'USED').length;
    const expiring = list.filter((v) => {
      if (v.status !== 'UNUSED') return false;
      const end = new Date(v.end_date).getTime();
      const diffHours = (end - now) / (1000 * 60 * 60);
      return diffHours > 0 && diffHours < 72;
    }).length;

    return { saved, used, expiring };
  }, [myVouchers]);

  const mockStats = {
    favorites: 12,
    checkin: 23,
    badges: 4,
    points: 850,
    maxPoints: 1000,
    rank: 'Vàng',
  };

  const recentStores = [
    {
      id: 1,
      name: 'ZStation Coffee',
      time: '2 giờ trước',
      img: 'https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=100&q=80',
    },
    {
      id: 2,
      name: 'K Coffee',
      time: 'Hôm qua',
      img: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=100&q=80',
    },
  ];

  const StatBox = ({ num, label, onClick, color = 'text-red-500' }: any) => (
    <div
      onClick={() => handleProtectedAction(onClick || (() => {}))}
      className="bg-white rounded-xl p-3 flex flex-col items-center justify-center shadow-sm border border-gray-50 active:scale-95 transition-transform h-24 cursor-pointer"
    >
      <Text className={`font-bold text-xl mb-1 ${color}`}>{num}</Text>
      <Text size="xxSmall" className="text-gray-500 text-center leading-3">
        {label}
      </Text>
    </div>
  );

  const SettingItem = ({ icon, label, isLast = false, onClick }: any) => (
    <div
      className={`flex items-center p-4 active:bg-gray-50 cursor-pointer ${
        !isLast ? 'border-b border-gray-100' : ''
      }`}
      onClick={onClick}
    >
      <div className="w-8 flex justify-center text-gray-500 text-lg mr-3">{icon}</div>
      <Text className="flex-1 font-medium text-gray-700 text-sm">{label}</Text>
      <MdOutlineKeyboardArrowRight className="text-gray-400 text-xl" />
    </div>
  );

  return (
    <Page className="bg-[#F4F5F7] h-full pb-24 overflow-y-auto">
      <div
        className="bg-white p-5 pt-12 pb-6 flex items-center gap-4 cursor-pointer"
        onClick={!user ? handleSyncUser : undefined}
      >
        <div className="relative">
          <Avatar
            src={user?.avatar || 'https://i.imgur.com/8Km9tLL.png'}
            size={64}
            className="border-2 border-red-50"
          >
            {user ? '' : 'U'}
          </Avatar>
        </div>
        <div className="flex-1">
          <Text.Title size="normal" className="font-extrabold text-gray-800">
            {user ? user.name : 'Đăng nhập / Đăng ký'}
          </Text.Title>
          <div className="flex items-center gap-1 mt-1">
            {user ? (
              <>
                <div className="flex text-yellow-400 text-[10px]">★★★★★</div>
                <Text size="xxSmall" className="text-gray-400">
                  Thành viên thân thiết
                </Text>
              </>
            ) : (
              <Text size="xxSmall" className="text-blue-500 font-medium">
                Chạm để đồng bộ tài khoản
              </Text>
            )}
          </div>
        </div>
      </div>

      <div className="px-3 -mt-2 space-y-3">
        <div className="bg-white rounded-xl p-4 shadow-sm">
          <div className="flex items-center gap-2 mb-3">
            <Icon icon="zi-poll-solid" className="text-pink-500" size={18} />
            <Text className="font-bold text-sm uppercase text-gray-700">Thẻ thành viên</Text>
          </div>

          <div className="bg-gradient-to-r from-yellow-400 to-amber-500 rounded-xl p-4 text-white shadow-lg shadow-yellow-100 relative overflow-hidden">
            <div className="relative z-10">
              <div className="flex justify-between items-start mb-1">
                <div>
                  <div className="font-bold text-lg">Hạng: {mockStats.rank}</div>
                  <div className="text-xs opacity-90">
                    {user ? mockStats.points : 0}/{mockStats.maxPoints} điểm
                  </div>
                </div>
                <FaCrown className="text-yellow-100 text-3xl opacity-50" />
              </div>

              <div className="w-full h-1.5 bg-black/10 rounded-full mt-2 mb-2 overflow-hidden">
                <div
                  className="h-full bg-white opacity-80 rounded-full"
                  style={{
                    width: user ? `${(mockStats.points / mockStats.maxPoints) * 100}%` : '0%',
                  }}
                ></div>
              </div>

              <div className="text-[10px] opacity-90 font-medium">
                {user ? 'Ưu đãi: Giảm thêm 5% mọi hóa đơn' : 'Đăng nhập để tích điểm'}
              </div>
            </div>
            <div className="absolute -right-4 -bottom-8 w-24 h-24 bg-white opacity-10 rounded-full"></div>
          </div>
        </div>

        <div className="grid grid-cols-4 gap-2">
          <StatBox
            num={voucherStats.saved}
            label="Voucher đã lưu"
            onClick={() => navigate('/my-voucher')}
          />

          <StatBox
            num={mockStats.favorites}
            label="Yêu thích"
            onClick={() => console.log('Chuyển trang Yêu thích cũ')}
          />

          <StatBox num={mockStats.checkin} label="Check-in" onClick={() => {}} />

          <StatBox num={mockStats.badges} label="Badge" onClick={() => {}} />
        </div>

        <div className="bg-white rounded-xl p-4 shadow-sm">
          <div className="flex justify-between items-center mb-4">
            <div className="flex items-center gap-2">
              <Icon icon="zi-note" className="text-orange-500" />
              <Text className="font-bold text-sm uppercase text-gray-700">Voucher của tôi</Text>
            </div>
            <Text
              size="small"
              className="text-red-500 font-medium cursor-pointer active:opacity-60"
              onClick={() => handleProtectedAction(() => navigate('/my-voucher'))}
            >
              Xem tất cả
            </Text>
          </div>

          <div className="flex text-center divide-x divide-gray-100">
            <div
              className="flex-1 cursor-pointer active:opacity-60"
              onClick={() => handleProtectedAction(() => navigate('/my-voucher'))}
            >
              <div className="text-xl font-bold text-red-500">{voucherStats.saved}</div>
              <div className="text-[10px] text-gray-400 mt-1">Đang lưu</div>
            </div>
            <div className="flex-1">
              <div className="text-xl font-bold text-green-500">{voucherStats.used}</div>
              <div className="text-[10px] text-gray-400 mt-1">Đã sử dụng</div>
            </div>
            <div className="flex-1">
              <div className="text-xl font-bold text-orange-500">{voucherStats.expiring}</div>
              <div className="text-[10px] text-gray-400 mt-1">Sắp hết hạn</div>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl p-4 shadow-sm">
          <div className="flex items-center gap-2 mb-3">
            <Icon icon="zi-location" className="text-blue-500" />
            <Text className="font-bold text-sm uppercase text-gray-700">Quán đã xem gần đây</Text>
          </div>

          <div className="space-y-4">
            {recentStores.map((store) => (
              <div
                key={store.id}
                className="flex items-center gap-3 active:opacity-60 cursor-pointer"
                onClick={() => navigate(`/store/${store.id}`)}
              >
                <img
                  src={store.img}
                  className="w-10 h-10 rounded-lg object-cover bg-gray-200"
                  alt=""
                />
                <div className="flex-1 border-b border-gray-50 pb-2">
                  <div className="flex justify-between items-center">
                    <Text className="font-bold text-gray-800 text-sm">{store.name}</Text>
                    <MdOutlineKeyboardArrowRight className="text-gray-400" />
                  </div>
                  <Text size="xxSmall" className="text-gray-400">
                    {store.time}
                  </Text>
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm overflow-hidden mb-4">
          <div className="p-4 pb-2 flex items-center gap-2">
            <Icon icon="zi-setting" className="text-gray-400" />
            <Text className="font-bold text-sm uppercase text-gray-700">Cài đặt</Text>
          </div>

          <div>
            <SettingItem
              icon={<FaMapMarkerAlt />}
              label="Địa chỉ đã lưu"
              onClick={() => handleProtectedAction(() => console.log('Chức năng địa chỉ cũ'))}
            />

            <SettingItem icon={<Icon icon="zi-notif-ring" />} label="Thông báo" />
            <SettingItem icon={<Icon icon="zi-lock" />} label="Quyền riêng tư" />
            <SettingItem icon={<Icon icon="zi-poll-solid" />} label="Trung tâm trợ giúp" />

            {user && (
              <SettingItem
                icon={<Icon icon="zi-leave" />}
                label="Đăng xuất"
                isLast
                onClick={(e: any) => {
                  e.stopPropagation();
                  setUser(null);
                  navigate('/welcome');
                }}
              />
            )}
          </div>
        </div>
      </div>
    </Page>
  );
};

export default ProfilePage;


================================================
FILE PATH: src\pages\profile\my-voucher\index.tsx
================================================
import React, { useEffect, useState, useMemo } from 'react';
import { Page, Header, Box, useSnackbar, Tabs } from 'zmp-ui';
import { useMyWallet } from '@/hooks/useMyWallet';
import VoucherTicket from './VoucherTicket';
import { useNavigate } from 'react-router-dom';

const MyVoucherPage: React.FC = () => {
  const { myVouchers, fetchMyWallet, useVoucher, loading } = useMyWallet();
  const { openSnackbar } = useSnackbar();
  const navigate = useNavigate();
  const [, setTick] = useState(0);

  useEffect(() => {
    fetchMyWallet();
    const interval = setInterval(() => setTick((t) => t + 1), 1000);
    return () => clearInterval(interval);
  }, [fetchMyWallet]);

  const handleUse = async (id: number) => {
    if (!useVoucher) return;
    const result: any = await useVoucher(id);
    if (result.success) {
      openSnackbar({ text: '✅ Sử dụng thành công!', type: 'success' });
    } else {
      openSnackbar({ text: result.message || 'Lỗi', type: 'error' });
    }
  };

  const { activeVouchers, historyVouchers } = useMemo(() => {
    const active: any[] = [];
    const history: any[] = [];
    const now = new Date().getTime();

    (myVouchers || []).forEach((item: any) => {
      const savedTime = new Date(item.saved_at).getTime();
      const holdingTime = (item.holding_time || 30) * 60 * 1000;
      const expireHoldTime = savedTime + holdingTime;
      const endDate = new Date(item.end_date).getTime();

      const isExpired = now > endDate;
      const isHoldExpired = now > expireHoldTime;
      const isUsed = item.status === 'USED';

      if (!isExpired && !isHoldExpired && !isUsed) {
        active.push(item);
      } else {
        history.push({ ...item });
      }
    });

    return { activeVouchers: active, historyVouchers: history };
  }, [myVouchers]);

  const EmptyState = ({ text }: { text: string }) => (
    <div className="flex flex-col items-center justify-center mt-12 opacity-60">
      <div className="text-4xl mb-2">🎫</div>
      <p className="text-gray-500 text-sm font-medium">{text}</p>
      <button
        onClick={() => navigate('/home')}
        className="mt-4 text-[#D83231] font-bold text-sm hover:underline"
      >
        Săn voucher mới →
      </button>
    </div>
  );

  return (
    <Page className="bg-gray-50 h-full pb-safe">
      <Header
        title="Ví Voucher Của Tôi"
        showBackIcon={true}
        className="bg-[#D83231] text-white"
        textColor="white"
      />

      <div className="mt-[80px] h-full flex flex-col">
        <Tabs id="my-voucher-tabs" className="flex-1 flex flex-col">
          <Tabs.Tab key="active" label={`Khả dụng (${activeVouchers.length})`}>
            <Box className="p-4 bg-gray-50 min-h-[80vh]">
              {loading ? (
                <div className="text-center py-10 text-gray-400 text-xs">Đang tải ví...</div>
              ) : activeVouchers.length > 0 ? (
                activeVouchers.map((item) => (
                  <VoucherTicket key={item.wallet_id} item={item} onUse={handleUse} />
                ))
              ) : (
                <EmptyState text="Bạn chưa có voucher nào khả dụng" />
              )}
            </Box>
          </Tabs.Tab>

          <Tabs.Tab key="history" label="Lịch sử">
            <Box className="p-4 bg-gray-50 min-h-[80vh]">
              {historyVouchers.length > 0 ? (
                historyVouchers.map((item) => (
                  <VoucherTicket key={item.wallet_id} item={item} onUse={() => {}} isHistory />
                ))
              ) : (
                <EmptyState text="Chưa có lịch sử sử dụng" />
              )}
            </Box>
          </Tabs.Tab>
        </Tabs>
      </div>
    </Page>
  );
};

export default MyVoucherPage;


================================================
FILE PATH: src\pages\profile\my-voucher\VoucherTicket.tsx
================================================
import React from 'react';
import { Text, Button } from 'zmp-ui';
import { formatDateVN, formatCountdown } from '@/utils/dateFormatter';

interface VoucherTicketProps {
  item: any;
  onUse: (id: number) => void;
  isHistory?: boolean;
}

const VoucherTicket: React.FC<VoucherTicketProps> = ({ item, onUse, isHistory = false }) => {
  const dateString = formatDateVN(item.end_date);

  const now = new Date().getTime();
  const savedTime = new Date(item.saved_at).getTime();
  const holdingTime = (item.holding_time || 30) * 60 * 1000;
  const endDate = new Date(item.end_date).getTime();

  const expireTime = Math.min(savedTime + holdingTime, endDate);
  const timeLeft = expireTime - now;

  const isFlashSale = item.type === 'FLASH_SALE';

  return (
    <div
      className={`relative flex w-full h-32 mb-4 filter drop-shadow-sm transition-all active:scale-[0.98] ${
        isHistory ? 'opacity-70 grayscale' : ''
      }`}
    >
      <div
        className={`w-[110px] flex flex-col items-center justify-center text-white rounded-l-xl relative ${
          isHistory
            ? 'bg-gray-400'
            : isFlashSale
            ? 'bg-gradient-to-br from-orange-500 to-red-600'
            : 'bg-gradient-to-br from-[#D83231] to-[#ff6b6b]'
        }`}
      >
        <div className="text-2xl font-black">{item.discount}</div>
        <div className="text-[10px] font-bold uppercase tracking-widest opacity-90 mt-1">
          {isFlashSale ? 'Flash Sale' : 'Voucher'}
        </div>
        <div
          className="absolute right-0 top-0 bottom-0 w-[4px]"
          style={{
            backgroundImage: 'radial-gradient(circle, #fff 2px, transparent 2.5px)',
            backgroundSize: '4px 8px',
          }}
        ></div>
      </div>

      <div className="flex-1 bg-white rounded-r-xl p-3 flex flex-col justify-between relative border border-l-0 border-gray-100">
        <div className="absolute -left-2 top-0 w-4 h-4 bg-gray-100 rounded-full mt-[-8px] z-10"></div>
        <div className="absolute -left-2 bottom-0 w-4 h-4 bg-gray-100 rounded-full mb-[-8px] z-10"></div>

        <div>
          <div className="flex justify-between items-start">
            <Text className="font-bold text-gray-800 line-clamp-1 text-sm flex-1 mr-2">
              {item.title}
            </Text>
          </div>
          <Text size="xxSmall" className="text-gray-500 line-clamp-1 mb-1">
            Tại: {item.store_name}
          </Text>

          {!isHistory && (
            <div className="flex flex-col gap-0.5 mt-1">
              <Text size="xxSmall" className="text-gray-500 font-medium">
                HSD: {dateString}
              </Text>

              <div className="flex items-center gap-1">
                <span className="text-[10px] text-gray-400">Giữ vé trong:</span>
                <span className="font-mono text-xs font-bold text-orange-600 bg-orange-50 px-1 rounded">
                  {timeLeft > 0 ? formatCountdown(timeLeft) : 'Hết hạn'}
                </span>
              </div>
            </div>
          )}

          {isHistory && (
            <Text size="xxSmall" className="text-gray-400 mt-1">
              Đã hết hạn vào: {dateString}
            </Text>
          )}
        </div>

        <div className="flex justify-between items-end border-t border-dashed border-gray-200 pt-2 mt-1">
          <div className="flex flex-col">
            <span className="text-[10px] text-gray-400">Mã code:</span>
            <span className="font-mono font-bold text-gray-700 text-xs select-all">
              {item.code}
            </span>
          </div>

          {!isHistory ? (
            <Button
              size="small"
              className="h-7 text-xs bg-[#D83231] text-white shadow-red-200 shadow-md"
              onClick={() => onUse(item.voucher_id)}
            >
              Dùng ngay
            </Button>
          ) : (
            <span className="text-xs font-bold text-gray-400 px-2 py-1 bg-gray-100 rounded">
              Đã qua
            </span>
          )}
        </div>
      </div>
    </div>
  );
};

export default VoucherTicket;


================================================
FILE PATH: src\pages\store\index.tsx
================================================
import React, { useEffect, useState } from 'react';
import { Page, Header, Box, Text, Button, Icon, useSnackbar } from 'zmp-ui';
import { useParams } from 'react-router-dom';
import api from '@/services/api';
import { useStore } from '@/hooks/useStore';

const StoreDetailPage: React.FC = () => {
  const { id } = useParams(); // Lấy ID quán từ URL
  const { saveVoucher, myVouchers } = useStore();
  const { openSnackbar } = useSnackbar();

  const [store, setStore] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  // Lấy danh sách ID voucher đã lưu để check trạng thái nút bấm
  const savedVoucherIds = new Set(myVouchers.map((v: any) => v.voucher_id));

  useEffect(() => {
    const fetchDetail = async () => {
      try {
        setLoading(true);
        // Gọi API lấy chi tiết quán (Backend đã có hàm getStoreDetail)
        const res: any = await api.get(`/api/store/detail/${id}`);
        if (res && res.data) {
          setStore(res.data);
        }
      } catch (error) {
        console.error('Lỗi lấy chi tiết quán:', error);
      } finally {
        setLoading(false);
      }
    };

    if (id) fetchDetail();
  }, [id]);

  const handleSave = (voucherId: number) => {
    saveVoucher(voucherId);
    openSnackbar({ text: 'Đã lưu vào ví!', type: 'success' });
  };

  if (loading)
    return (
      <div className="flex justify-center mt-20">
        <div className="w-8 h-8 border-4 border-orange-500 rounded-full animate-spin border-t-transparent"></div>
      </div>
    );

  if (!store) return <div className="text-center mt-20">Không tìm thấy quán</div>;

  return (
    <Page className="bg-white pb-20 relative">
      {/* Header trong suốt đè lên ảnh */}
      <Header
        title="Chi tiết quán"
        showBackIcon
        className="absolute top-0 left-0 right-0 z-50 bg-transparent text-white shadow-none"
        style={{ background: 'transparent' }}
        textColor="white"
      />

      {/* Ảnh bìa */}
      <div className="relative h-60 w-full">
        <img
          src={store.image || 'https://via.placeholder.com/400x200'}
          className="w-full h-full object-cover"
          alt={store.name}
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>

        <div className="absolute bottom-4 left-4 right-4 text-white">
          <Text.Title size="large" className="font-bold mb-1">
            {store.name}
          </Text.Title>
          <div className="flex items-center gap-1 text-sm opacity-90">
            <Icon icon="zi-location-solid" size={16} />
            <span className="line-clamp-1">{store.address}</span>
          </div>
        </div>
      </div>

      {/* Nội dung chính */}
      <Box p={4} className="-mt-4 bg-white rounded-t-2xl relative z-10 min-h-screen">
        <div className="flex gap-4 mb-6 border-b border-gray-100 pb-4">
          <div className="flex-1 text-center">
            <div className="font-bold text-lg">4.8 ⭐</div>
            <div className="text-xs text-gray-500">Đánh giá</div>
          </div>
          <div className="w-[1px] bg-gray-200"></div>
          <div className="flex-1 text-center">
            <div className="font-bold text-lg text-green-600">Đang mở</div>
            <div className="text-xs text-gray-500">07:00 - 22:00</div>
          </div>
        </div>

        <Text.Title size="normal" className="font-bold mb-4 uppercase">
          Voucher ưu đãi ({store.vouchers?.length || 0})
        </Text.Title>

        <div className="space-y-4">
          {store.vouchers &&
            store.vouchers.map((v: any) => {
              const isSaved = savedVoucherIds.has(v.id);
              return (
                <div
                  key={v.id}
                  className="border border-orange-100 bg-orange-50/30 rounded-xl p-3 flex justify-between items-center relative overflow-hidden"
                >
                  {/* Trang trí */}
                  <div className="absolute top-0 left-0 w-1 h-full bg-orange-500"></div>

                  <div className="flex-1 pl-3">
                    <Text className="font-bold text-gray-800">{v.title}</Text>
                    <div className="flex items-center gap-2 mt-1">
                      <span className="bg-white border border-gray-200 text-xs px-2 py-0.5 rounded text-gray-500 font-mono">
                        {v.code}
                      </span>
                      <span className="text-orange-600 font-bold text-xs">Giảm {v.discount}</span>
                    </div>
                  </div>

                  <Button
                    size="small"
                    className={`h-8 min-w-[80px] text-xs font-bold shadow-none ${
                      isSaved ? 'bg-gray-200 text-gray-500' : 'bg-orange-500 text-white'
                    }`}
                    disabled={isSaved}
                    onClick={() => !isSaved && handleSave(v.id)}
                  >
                    {isSaved ? 'Đã lưu' : 'Lưu'}
                  </Button>
                </div>
              );
            })}

          {(!store.vouchers || store.vouchers.length === 0) && (
            <div className="text-center text-gray-400 italic py-4">Chưa có voucher nào</div>
          )}
        </div>
      </Box>
    </Page>
  );
};

export default StoreDetailPage;


================================================
FILE PATH: src\pages\voucher\CategoryTabs.tsx
================================================
import React from 'react';
import { VOUCHER_TABS } from '@/constants/categories';

interface CategoryTabsProps {
  activeTab: string;
  setActiveTab: (tab: string) => void;
}

const CategoryTabs: React.FC<CategoryTabsProps> = ({ activeTab, setActiveTab }) => {
  return (
    <div className="sticky top-0 z-50 bg-white border-b border-gray-100 shadow-sm">
      <div className="flex overflow-x-auto no-scrollbar px-4 pt-3 pb-1 gap-6">
        {VOUCHER_TABS.map((cat) => {
          const isActive = activeTab === cat;
          return (
            <div
              key={cat}
              onClick={() => setActiveTab(cat)}
              className={`flex-shrink-0 pb-2 cursor-pointer transition-all font-medium text-sm ${
                isActive
                  ? 'text-[#D83231] border-b-2 border-[#D83231] font-bold'
                  : 'text-gray-500 border-b-2 border-transparent'
              }`}
            >
              {cat}
            </div>
          );
        })}
      </div>
    </div>
  );
};

export default CategoryTabs;


================================================
FILE PATH: src\pages\voucher\FlashSaleSection.tsx
================================================
import { useEffect, useState } from 'react';
import { Box, Text, Button, Icon } from 'zmp-ui';
import { useStore } from '@/hooks/useStore';
import { formatCountdown } from '@/utils/dateFormatter';

const FlashSaleCard = ({ item }: { item: any }) => {
  const [timeLeft, setTimeLeft] = useState('');
  const { saveVoucher } = useStore();

  useEffect(() => {
    const calculateTime = () => {
      const end = new Date(item.end_date).getTime();
      const now = new Date().getTime();
      const diff = end - now;
      return formatCountdown(diff);
    };
    const timer = setInterval(() => setTimeLeft(calculateTime()), 1000);
    return () => clearInterval(timer);
  }, [item.end_date]);

  return (
    <div className="bg-[#FFECC7] rounded-xl p-4 mb-4 border border-orange-100 relative overflow-hidden">
      <div className="flex items-center gap-2 mb-2">
        <div className="bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-md flex items-center gap-1">
          <Icon icon="zi-poll" size={14} />
          <span>-{item.discount}</span>
          <span className="w-[1px] h-3 bg-white/40 mx-1"></span>
          <span className="font-mono">{timeLeft}</span>
        </div>
      </div>

      <Text.Title size="small" className="font-bold text-gray-800 line-clamp-1 mb-1">
        {item.store_name} - {item.title}
      </Text.Title>

      <Text size="xxSmall" className="text-gray-500 mb-3 line-clamp-1">
        #{item.code} • Áp dụng tất cả chi nhánh
      </Text>

      <Button
        size="small"
        className="bg-[#D83231] text-white font-bold h-8 rounded-full px-6 shadow-red-200"
        onClick={() => saveVoucher(item.id)}
      >
        Lưu voucher
      </Button>

      <div className="absolute -right-4 -bottom-4 w-16 h-16 bg-orange-300 opacity-20 rounded-full"></div>
    </div>
  );
};

const FlashSaleSection = ({ flashSales }: { flashSales: any[] }) => {
  if (!flashSales || flashSales.length === 0) return null;
  return (
    <Box className="bg-white p-4 pb-2">
      <div className="flex items-center gap-2 mb-3">
        <Icon icon="zi-poll-solid" className="text-orange-500" />
        <Text.Title size="normal" className="font-extrabold uppercase text-gray-800">
          FLASH SALE ĐANG DIỄN RA
        </Text.Title>
      </div>

      {flashSales.slice(0, 3).map((item) => (
        <FlashSaleCard key={item.id} item={item} />
      ))}
    </Box>
  );
};

export default FlashSaleSection;


================================================
FILE PATH: src\pages\voucher\index.tsx
================================================
import React, { useEffect, useState, useMemo } from 'react';
import { Page, Box, Header } from 'zmp-ui';
import { useStore } from '@/hooks/useStore';
import CategoryTabs from './CategoryTabs';
import FlashSaleSection from './FlashSaleSection';
import StoreDealList from './StoreDealList';

const PromotionPage: React.FC = () => {
  const { stores, flashSales, fetchNearby, fetchFlashSales } = useStore();

  const [activeTab, setActiveTab] = useState('Tất cả');

  useEffect(() => {
    fetchFlashSales();
    fetchNearby();
  }, []);

  const filteredStores = useMemo(() => {
    if (!stores) return [];
    if (activeTab === 'Tất cả') return stores;
    return stores.filter((s) => s.category?.toLowerCase().includes(activeTab.toLowerCase()));
  }, [stores, activeTab]);

  return (
    <Page className="bg-gray-100 h-full">
      <Header title="Khuyến mãi" showBackIcon />
      <Box className="h-20 bg-gray-100" />

      <CategoryTabs activeTab={activeTab} setActiveTab={setActiveTab} />

      <div className="overflow-y-auto h-full pb-safe">
        {activeTab === 'Tất cả' || activeTab === 'Flash Sale' ? (
          <FlashSaleSection flashSales={flashSales} />
        ) : null}

        <StoreDealList stores={filteredStores} />
      </div>
    </Page>
  );
};

export default PromotionPage;


================================================
FILE PATH: src\pages\voucher\StoreDealList.tsx
================================================
import React from 'react';
import { Box, Text, Button, Icon } from 'zmp-ui';
import { Store } from '@/types/store';
import { useNavigate } from 'react-router-dom';

const StoreDealItem = ({ store }: { store: Store }) => {
  const navigate = useNavigate();
  // Filter voucher thường (không phải flash sale)
  const normalVouchers = store.vouchers?.filter((v) => v.type !== 'FLASH_SALE') || [];
  const voucherCount = normalVouchers.length;

  // Fake rating vì trong model chưa có
  const rating = 4.5;
  const reviewCount = Math.floor(Math.random() * 100) + 10;

  if (voucherCount === 0) return null;

  return (
    <div className="bg-white p-4 border-b border-gray-50 last:border-none flex gap-4">
      {/* Ảnh quán (Vuông bo góc) */}
      <div className="w-28 h-28 flex-shrink-0">
        <img
          src={store.image || 'https://via.placeholder.com/150'}
          className="w-full h-full object-cover rounded-xl bg-gray-100 border border-gray-100"
          alt={store.name}
        />
      </div>

      {/* Thông tin bên phải */}
      <div className="flex-1 min-w-0 flex flex-col">
        <Text.Title size="small" className="font-bold text-gray-800 line-clamp-1 uppercase">
          {store.name}
        </Text.Title>

        {/* Rating */}
        <div className="flex items-center gap-1 my-1">
          <div className="flex text-yellow-400 text-xs">
            {'★★★★★'.split('').map((s, i) => (
              <span
                key={i}
                className={i < Math.floor(rating) ? 'text-yellow-400' : 'text-gray-300'}
              >
                ★
              </span>
            ))}
          </div>
          <Text size="xxSmall" className="text-gray-500">
            {rating} ({reviewCount} đánh giá)
          </Text>
        </div>

        {/* Badge số lượng ưu đãi */}
        <div className="mb-2">
          <span className="bg-pink-50 text-pink-500 text-[10px] font-bold px-2 py-0.5 rounded-full inline-block">
            {voucherCount} ưu đãi đang có
          </span>
        </div>

        {/* List voucher text (tối đa 2 dòng) */}
        <div className="mb-3 space-y-0.5">
          {normalVouchers.slice(0, 2).map((v) => (
            <div key={v.id} className="flex items-center gap-1.5">
              <div className="w-1 h-1 rounded-full bg-gray-400"></div>
              <Text size="xxSmall" className="text-gray-500 line-clamp-1">
                {v.title}
              </Text>
            </div>
          ))}
          {voucherCount > 2 && (
            <Text size="xxSmall" className="text-gray-400 italic pl-2.5">
              + {voucherCount - 2} ưu đãi khác...
            </Text>
          )}
        </div>

        {/* Nút Xem chi tiết */}
        <div className="mt-auto">
          <Button
            size="small"
            className="bg-[#D83231] text-white font-bold h-7 text-xs rounded-full px-4"
            onClick={() => navigate(`/store/${store.id}`)}
          >
            Xem chi tiết
          </Button>
        </div>
      </div>
    </div>
  );
};

const StoreDealList = ({ stores }: { stores: Store[] }) => {
  // Lọc chỉ những quán có voucher
  const storesWithDeals = stores.filter((s) => s.vouchers && s.vouchers.length > 0);

  return (
    <Box className="bg-white mt-2 pb-20">
      <div className="p-4 pb-0 flex justify-between items-end">
        <div className="flex items-center gap-2">
          <Icon icon="zi-poll-solid" className="text-pink-500 font-bold" />
          <div>
            <Text.Title size="normal" className="font-extrabold uppercase text-gray-800">
              Ưu đãi dành cho bạn
            </Text.Title>
            <Text size="xxSmall" className="text-gray-400">
              {storesWithDeals.length} cửa hàng • 5km quanh bạn
            </Text>
          </div>
        </div>
      </div>

      <div className="divide-y divide-gray-50">
        {storesWithDeals.map((store) => (
          <StoreDealItem key={store.id} store={store} />
        ))}
      </div>

      {storesWithDeals.length === 0 && (
        <div className="text-center py-10 text-gray-400 text-sm">
          Không tìm thấy ưu đãi nào quanh đây :(
        </div>
      )}
    </Box>
  );
};

export default StoreDealList;


================================================
FILE PATH: src\pages\welcome\index.tsx
================================================
import React, { useEffect, useState } from 'react';
import { Page, Button, Text, Icon } from 'zmp-ui';
import { useNavigate } from 'react-router-dom';

const WelcomePage: React.FC = () => {
  const navigate = useNavigate();
  const [visible, setVisible] = useState(false);

  useEffect(() => {
    setTimeout(() => setVisible(true), 100);
  }, []);

  const handleContinue = () => {
    navigate('/home');
  };

  const BRAND_COLOR = '#D83231';

  return (
    <Page className="relative flex flex-col h-screen bg-white overflow-y-auto">
      <div className="relative flex-shrink-0 h-[50vh] w-full flex flex-col pb-20 justify-center z-0 overflow-hidden">
        <div className="absolute inset-0 z-0">
          <img
            src="https://res.cloudinary.com/dzpyhq3z5/image/upload/v1765443946/Ảnh_chụp_màn_hình_2025-12-11_160519_snnauc.png"
            className="w-full h-full object-cover opacity-50"
            alt="Bản đồ Thái Nguyên"
          />
          <div className="absolute inset-0 bg-gradient-to-b from-white/20 via-white/50 to-white"></div>
        </div>

        <div className="absolute inset-0 z-0 pointer-events-none">
          <div
            className={`absolute top-[20%] left-[15%] text-red-500 transform transition-all duration-1000 delay-300 ${
              visible ? 'translate-y-0 opacity-100' : '-translate-y-4 opacity-0'
            }`}
          >
            <div className="animate-[bounce_3s_infinite]">
              <Icon icon="zi-location-solid" size={32} className="drop-shadow-md" />
            </div>
            <div className="w-6 h-1.5 bg-black/10 rounded-full blur-[1px] mx-auto animate-pulse mt-1"></div>
          </div>

          <div
            className={`absolute top-[30%] right-[15%] transform transition-all duration-1000 delay-500 ${
              visible ? 'translate-y-0 opacity-100' : '-translate-y-4 opacity-0'
            }`}
          >
            <div className="relative animate-[bounce_4s_infinite]">
              <div className="w-12 h-12 bg-white p-1 rounded-full shadow-lg border-2 border-orange-500 z-10 relative overflow-hidden">
                <img
                  src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=100&q=80"
                  className="w-full h-full rounded-full object-cover"
                  alt="Store"
                />
              </div>
              <div className="absolute -bottom-1 left-1/2 -translate-x-1/2 w-3 h-3 bg-orange-500 rotate-45 transform origin-center -z-10"></div>
            </div>
          </div>

          <div
            className={`absolute bottom-[30%] left-[45%] transform transition-all duration-1000 delay-700 ${
              visible ? 'translate-y-0 opacity-100' : '-translate-y-4 opacity-0'
            }`}
          >
            <div className="relative animate-[bounce_2.5s_infinite]">
              <Icon icon="zi-location-solid" size={48} className="text-[#D83231] drop-shadow-xl" />
              <div className="absolute -top-4 -right-8 bg-yellow-400 text-red-600 text-[10px] font-extrabold px-2 py-0.5 rounded shadow-sm border border-white rotate-6">
                VOUCHER
              </div>
            </div>
          </div>
        </div>

        <div
          className={`relative z-10 text-center px-4  transition-all duration-700 transform ${
            visible ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0'
          }`}
        >
          <h1 className="text-4xl font-black text-gray-800 text-left tracking-tighter leading-none drop-shadow-sm mb-3">
            THÁI NGUYÊN <br />
            <span className="text-[#D83231] text-5xl">VOUCHER MAPS</span>
          </h1>

          <p className="text-[#D83231] text-base font-bold bg-white/80 backdrop-blur-md py-1.5 px-4 rounded-xl inline-block shadow-sm border border-white/50">
            "Đi đâu cũng có deal, ăn gì cũng tiết kiệm"
          </p>
        </div>
      </div>

      <div
        className={`flex-1 bg-white -mt-8 relative z-10 rounded-t-[32px] border-t border-[#D83231] px-6 pt-4 pb-safe flex flex-col transition-all duration-700 delay-500 transform ${
          visible ? 'translate-y-0 opacity-100' : 'translate-y-20 opacity-0'
        }`}
      >
        <div className="text-center mb-4 flex-shrink-0">
          <Text.Title className="text-lg font-bold text-gray-800 uppercase">
            Khám phá Thái Nguyên
          </Text.Title>
          <Text className="text-gray-500 mt-1 text-xs px-2 line-clamp-2">
            Tìm quán ngon, nhận voucher ưu đãi và tiết kiệm chi phí mỗi ngày.
          </Text>
        </div>

        <div className="space-y-3 mb-2 flex-1 overflow-y-auto min-h-0">
          <FeatureItem
            icon="zi-location-solid"
            text="Bản đồ quán ăn phủ sóng toàn TP"
            color={BRAND_COLOR}
          />
          <FeatureItem
            icon="zi-star-solid"
            text="Hàng ngàn Voucher độc quyền"
            color={BRAND_COLOR}
          />
          <FeatureItem icon="zi-link" text="Xác thực và liên kết tài khoản" color={BRAND_COLOR} />
        </div>

        <div className="mt-auto pt-2 pb-4">
          <Button
            fullWidth
            size="large"
            onClick={handleContinue}
            className="rounded-xl h-12 text-lg font-bold shadow-lg shadow-red-200 active:scale-95 transition-transform"
            style={{
              backgroundColor: BRAND_COLOR,
              border: 'none',
            }}
          >
            Bắt đầu trải nghiệm
          </Button>
        </div>
      </div>
    </Page>
  );
};

const FeatureItem = ({ icon, text, color }: { icon: string; text: string; color: string }) => (
  <div className="flex items-center gap-3 p-2.5 rounded-xl bg-gray-50 border border-gray-100 hover:bg-red-50 transition-colors">
    <div className="w-8 h-8 rounded-full bg-white shadow-sm flex items-center justify-center shrink-0">
      <Icon icon={icon as any} style={{ color: color }} />
    </div>
    <Text className="text-gray-700 font-medium text-sm line-clamp-1">{text}</Text>
  </div>
);

export default WelcomePage;


================================================
FILE PATH: src\services\api.ts
================================================
import axios, { AxiosError } from 'axios';

const BASE_URL = import.meta.env.VITE_BACKEND_URL;

const api = axios.create({
  baseURL: BASE_URL,
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json',
    'ngrok-skip-browser-warning': 'true',
    'bypass-tunnel-reminder': 'true',
    'X-Requested-With': 'XMLHttpRequest',
  },
});

api.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error: AxiosError) => {
    if (error.response) {
      if (error.response.status === 429) {
        console.warn('⚠️ Server đang quá tải, vui lòng chờ chút!');
      }

      if (error.response.status === 401) {
      }
    }
    console.error('API Error:', error.response || error.message);
    return Promise.reject(error);
  }
);

export default api;


================================================
FILE PATH: src\services\store.service.ts
================================================
import api from './api';
import { ApiResponse } from '@/types/api';
import { Store, Voucher, FlashSaleItem } from '@/types/store';

interface NearbyParams {
  lat: number;
  lng: number;
  radius?: number;
  category?: string;
}

export const storeService = {
  // 1. Lấy danh sách quán
  getNearby: (params: NearbyParams) =>
    api.get('/api/store/nearby', {
      params: { ...params, radius: params.radius || 10 },
    }) as Promise<ApiResponse<Store[]>>,

  // 2. Tìm kiếm quán
  search: (keyword: string) =>
    api.get('/api/store/search', { params: { q: keyword } }) as Promise<ApiResponse<Store[]>>,

  // 3. Lấy ví voucher
  getMyWallet: (accessToken: string) =>
    api.get('/api/store/my-wallet', {
      headers: { Authorization: `Bearer ${accessToken}` },
    }) as Promise<ApiResponse<Voucher[]>>,

  // 4. Lưu voucher
  saveVoucher: (voucherId: number, accessToken: string) =>
    api.post(
      '/api/store/save',
      { voucherId },
      { headers: { Authorization: `Bearer ${accessToken}` } }
    ) as Promise<ApiResponse<null>>,

  // 5. Hủy lưu voucher
  unsaveVoucher: (voucherId: number, accessToken: string) =>
    api.post(
      '/api/store/unsave',
      { voucherId },
      { headers: { Authorization: `Bearer ${accessToken}` } }
    ) as Promise<ApiResponse<null>>,

  // 6. Sử dụng voucher
  useVoucher: (voucherId: number, accessToken: string) =>
    api.post(
      '/api/store/use',
      { voucherId },
      { headers: { Authorization: `Bearer ${accessToken}` } }
    ) as Promise<ApiResponse<null>>,

  // 7. Lấy Flash Sale
  getFlashSales: (accessToken: string, category?: string) =>
    api.get('/api/store/flash-sale', {
      headers: { Authorization: `Bearer ${accessToken}` },
      params: { category },
    }) as Promise<ApiResponse<FlashSaleItem[]>>,

  // 8. Lấy chi tiết quán
  getDetail: (id: string | number) =>
    api.get(`/api/store/detail/${id}`) as Promise<ApiResponse<Store>>,
};


================================================
FILE PATH: src\states\state.ts
================================================
import { atom } from 'recoil';
import { Store } from '@/types/store';
import { User } from '@/types/user';

export const userLocationState = atom<[number, number]>({
  key: 'userLocationState',
  default: [21.597631, 105.840984],
});

export const locationLoadingState = atom<boolean>({
  key: 'locationLoadingState',
  default: false,
});

export const storesState = atom<any[]>({
  key: 'storesState',
  default: [],
});

export const myVouchersState = atom<any[]>({
  key: 'myVouchersState',
  default: [],
});

export const selectedStoreState = atom<Store | null>({
  key: 'selectedStoreState',
  default: null,
});

export const userState = atom<User | null>({
  key: 'userState',
  default: null,
});

export const userLoadingState = atom<boolean>({
  key: 'userLoadingState',
  default: false,
});

export const flashSaleState = atom<any[]>({
  key: 'flashSaleState',
  default: [],
});

export const locationPermissionDeniedState = atom<boolean>({
  key: 'locationPermissionDeniedState',
  default: false,
});


================================================
FILE PATH: src\types\api.ts
================================================
export interface ApiResponse<T> {
  success: boolean;
  data: T;
  message?: string;
  error?: string;
}

export interface VoucherActionPayload {
  voucherId: number;
}


================================================
FILE PATH: src\types\store.ts
================================================
export interface Voucher {
  id: number;
  voucher_id?: number;
  title: string;
  code: string;
  discount: string;
  discount_percent?: number;
  end_date: string;
  type: 'DEFAULT' | 'FLASH_SALE';
  store_name?: string;
  status?: 'UNUSED' | 'USED';
  saved_at?: string;
  holding_time?: number;
}

export interface FlashSaleItem extends Voucher {
  quantity: number;
  is_saved: boolean;
  store_id: number;
  image?: string;
}

export interface Store {
  id: number;
  name: string;
  address: string;
  lat: number;
  lng: number;
  image?: string;
  category?: string;
  vouchers?: Voucher[];
  distance?: number;
}


================================================
FILE PATH: src\types\user.ts
================================================
export interface User {
  id: string;
  name: string;
  avatar: string;
  zalo_id?: string;
  is_active?: boolean;
}


================================================
FILE PATH: src\utils\dateFormatter.ts
================================================
export const formatCountdown = (milliseconds: number): string => {
  if (milliseconds <= 0) return '00:00:00';

  const totalSec = Math.floor(milliseconds / 1000);
  const h = Math.floor(totalSec / 3600)
    .toString()
    .padStart(2, '0');
  const m = Math.floor((totalSec % 3600) / 60)
    .toString()
    .padStart(2, '0');
  const s = (totalSec % 60).toString().padStart(2, '0');

  return `${h}:${m}:${s}`;
};

export const formatDateVN = (dateInput: string | Date | number): string => {
  const date = new Date(dateInput);
  if (isNaN(date.getTime())) return '';

  return date.toLocaleDateString('vi-VN', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
  });
};


================================================
FILE PATH: tailwind.config.js
================================================
module.exports = {
  darkMode: ['selector', '[zaui-theme="dark"]'],
  purge: {
    enabled: true,
    content: ['./src/**/*.{js,jsx,ts,tsx,vue}'],
  },
  theme: {
    extend: {
      colors: {
        primary: '#D83231',
        secondary: '#F6B025',
        success: '#00A300',
      },
      fontFamily: {
        mono: ['Roboto Mono', 'monospace'],
      },
    },
  },
};


================================================
FILE PATH: tsconfig.json
================================================
{
  "compilerOptions": {
    "noEmit": true,
    "target": "es6",
    "module": "esnext",
    "noImplicitAny": false,
    "preserveConstEnums": true,
    "jsx": "react-jsx",
    "lib": ["dom", "es5", "es6", "es7", "es2017"],
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "allowJs": true,
    "skipLibCheck": true,
    "declaration": false,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "noEmitOnError": true,
    "noFallthroughCasesInSwitch": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": false,
    "strict": true,
    "strictFunctionTypes": false,
    "pretty": true,
    "removeComments": true,
    "sourceMap": true,
    "resolveJsonModule": true,
    "types": ["vite/client"],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "exclude": ["node_modules"],
  "include": ["src"]
}


================================================
FILE PATH: www\app-config.json
================================================
{"app":{"title":"zaui-LoctionVoucher","textColor":{"light":"black","dark":"white"},"statusBar":"transparent","actionBarHidden":true,"hideIOSSafeAreaBottom":false,"hideAndroidBottomNavigationBar":false},"listCSS":["assets/index-Ch9Zyya-.css"],"listSyncJS":["assets/index.D6u_Cp7Y.module.js"],"listAsyncJS":[],"pages":[]}

================================================
FILE PATH: zmp-cli.json
================================================
{
  "cwd": "/Users/lap15182-local/Documents/zmp-blank-templates",
  "name": "zmp-blank-templates",
  "appId": "3423294335863914988",
  "framework": "react-typescript",
  "cssPreProcessor": "scss",
  "includeTailwind": true,
  "package": "zmp-ui",
  "stateManagement": "jotai",
  "newProject": true,
  "template": "single-view",
  "theming": {
    "customColor": false,
    "color": "#007aff",
    "darkTheme": false,
    "iconFonts": true,
    "fillBars": false,
    "useUiKits": true
  }
}
